!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("Avalon requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(window,noGlobal){function log(){avalon.config.debug&&console.log.apply(console,arguments)}function createMap(){return Object.create(null)}function noop(){}function oneObject(e,t){"string"==typeof e&&(e=e.match(rword)||[]);for(var r={},n=void 0!==t?t:1,a=0,o=e.length;o>a;a++)r[e[a]]=n;return r}function IE(){if(window.VBArray){var e=document.documentMode;return e?e:window.XMLHttpRequest?7:6}return 0}function _number(e,t){return e=Math.floor(e)||0,0>e?Math.max(t+e,0):Math.min(e,t)}function isArrayLike(e){if(e&&"object"==typeof e){var t=e.length,r=serialize.call(e);if(/(Array|List|Collection|Map|Arguments)\]$/.test(r))return!0;if("[object Object]"===r&&t===t>>>0)return!0}return!1}function enumerateNode(e,t){if(e&&e.childNodes)for(var r,n=e.childNodes,a=0;r=n[a++];)if(r.tagName){var o=DOC.createElementNS(svgns,r.tagName.toLowerCase());ap.forEach.call(r.attributes,function(e){o.setAttribute(e.name,e.value)}),enumerateNode(r,o),t.appendChild(o)}}function kernel(e){for(var t in e)if(ohasOwn.call(e,t)){var r=e[t];"function"==typeof kernel.plugins[t]?kernel.plugins[t](r):"object"==typeof kernel[t]?avalon.mix(kernel[t],r):kernel[t]=r}return this}function escapeRegExp(e){return(e+"").replace(rregexp,"\\$&")}function isObservable(e,t,r){if(isFunction(t)||t&&t.nodeType)return!1;if(-1!==r.indexOf(e))return!1;if(-1!==$$skipArray.indexOf(e))return!1;var n=r.$special;return e&&"$"===e.charAt(0)&&!n[e]?!1:!0}function getNewValue(e,t,r,n){switch(e.type){case 0:var a=e.get,o=e.set;if(isFunction(o)){var i=n.$events,s=i[t];i[t]=[],o.call(n,r),i[t]=s}return a.call(n);case 1:return r;case 2:if(r!==n.$model[t]){var l=e.svmodel=objectFactory(n,t,r,e.valueType);r=l.$model;var c=midway[l.$id];c&&c()}return r}}function modelFactory(e,t,r){if(Array.isArray(e)){var n=e.concat();e.length=0;var a=Collection(e);return a.pushArray(n),a}if(!e||e.nodeType>0||e.$id&&e.$events)return e;Array.isArray(e.$skipArray)||(e.$skipArray=[]),e.$skipArray.$special=t||createMap();var o={};r=r||{};var i=createMap(),s=createMap(),l=[];for(var c in e)!function(t,n){if(r[t]=n,isObservable(t,n,e.$skipArray)){i[t]=[];var a=avalon.type(n),c=function(e){var t=c._name,r=this,n=r.$model,a=n[t],o=r.$events;return arguments.length?void(stopRepeatAssign||(1===c.type||(e=getNewValue(c,t,e,r),c.type))&&(isEqual(a,e)||(n[t]=e,notifySubscribers(o[t]),safeFire(r,t,e,a)))):0===c.type?(e=c.get.call(r),a!==e&&(n[t]=e,safeFire(r,t,e,a)),e):(collectSubscribers(o[t]),c.svmodel||a)};"object"===a&&isFunction(n.get)&&Object.keys(n).length<=2?(c.set=n.set,c.get=n.get,c.type=0,l.push(function(){var e={evaluator:function(){e.type=Math.random(),e.element=null,r[t]=c.get.call(o)},element:head,type:Math.random(),handler:noop,args:[]};Registry[expose]=e,c.call(o),delete Registry[expose]})):rcomplexType.test(a)?(c.type=2,c.valueType=a,l.push(function(){var e=modelFactory(n,0,r[t]);c.svmodel=e,e.$events[subscribers]=i[t]})):c.type=1,c._name=t,s[t]=c}}(c,e[c]);$$skipArray.forEach(function(t){delete e[t],delete r[t]}),o=Object.defineProperties(o,descriptorFactory(s),e);for(var u in e)s[u]||(o[u]=e[u]);o.$id=generateID(),o.$model=r,o.$events=i;for(c in EventBus)o[c]=EventBus[c];return Object.defineProperty(o,"hasOwnProperty",{value:function(e){return e in this.$model},writable:!1,enumerable:!1,configurable:!0}),l.forEach(function(e){e()}),o}function safeFire(e,t,r,n){e.$events&&EventBus.$fire.call(e,t,r,n)}function objectFactory(e,t,r,n){var a=e[t];if("array"===n)return Array.isArray(r)&&a!==r?(a._.$unwatch(),a.clear(),a._.$watch(),a.pushArray(r.concat()),a):a;var o=e.$events[t],i=modelFactory(r);return i.$events[subscribers]=o,midway[i.$id]=function(e){for(;e=o.shift();)!function(e){avalon.nextTick(function(){var t=e.type;t&&bindingHandlers[t]&&(e.rollback&&e.rollback(),bindingHandlers[t](e,e.vmodels))})}(e);delete midway[i.$id]},i}function Collection(e){var t=[];t.$id=generateID(),t.$model=e,t.$events={},t.$events[subscribers]=[],t._=modelFactory({length:e.length}),t._.$watch("length",function(e,r){t.$fire("length",e,r)});for(var r in EventBus)t[r]=EventBus[r];return t.$map={el:1},t.$proxy=[],avalon.mix(t,CollectionPrototype),t}function mutateArray(e,t,r,n,a,o,i){for(var s=this.length,l=2;--l;){switch(e){case"add":for(var c=t+r,u=this.$model.slice(t,c).map(function(e){return rcomplexType.test(avalon.type(e))?e.$id?e:modelFactory(e,0,e):e}),p=t;c>p;p++){var d=eachProxyAgent(p,this);this.$proxy.splice(p,0,d)}_splice.apply(this,[t,0].concat(u)),this._fire("add",t,r);break;case"del":var f=this._splice(t,r),v=this.$proxy.splice(t,r);recycleProxies(v,"each"),this._fire("del",t,r)}a&&(e=a,t=o,r=i,l=2,a=0)}return resetIndex(this.$proxy,n),this.length!==s&&(this._.length=this.length),f}function resetIndex(e,t){for(var r,n=e.length-1;r=e[t];t++)r.$index=t,r.$first=0===t,r.$last=t===n}function sortByIndex(e,t){for(var r={},n=0,a=t.length;a>n;n++){r[n]=e[n];var o=t[n];o in r?(e[n]=r[o],delete r[o]):e[n]=e[o]}}function collectSubscribers(e){var t=Registry[expose];e&&t&&avalon.Array.ensure(e,t)&&t.element&&addSubscribers(t,e)}function addSubscribers(e,t){e.$uuid=e.$uuid||generateID(),t.$uuid=t.$uuid||generateID();var r={data:e,list:t,$$uuid:e.$uuid+t.$uuid};$$subscribers[r.$$uuid]||($$subscribers[r.$$uuid]=1,$$subscribers.push(r))}function disposeData(e){e.element=null,e.rollback&&e.rollback();for(var t in e)e[t]=null}function isRemove(e){try{if(!e.parentNode)return!0}catch(t){return!0}return e.msRetain?0:1===e.nodeType?"number"==typeof e.sourceIndex?0===e.sourceIndex:!root.contains(e):!avalon.contains(root,e)}function removeSubscribers(){for(var e,t=$$subscribers.length,r=t,n=0,a=[],o={},i={};e=$$subscribers[--t];){var s=e.data,l=s.type;o[l]?o[l]++:(o[l]=1,a.push(l))}var c=!1;if(a.forEach(function(e){oldInfo[e]!==o[e]&&(i[e]=1,c=!0)}),t=r,c)for(;e=$$subscribers[--t];)s=e.data,void 0!==s.element&&i[s.type]&&isRemove(s.element)&&(n++,$$subscribers.splice(t,1),delete $$subscribers[e.$$uuid],avalon.Array.remove(e.list,s),disposeData(s),e.data=e.list=null);oldInfo=o,beginTime=new Date}function notifySubscribers(e){if(e&&e.length){new Date-beginTime>444&&"object"==typeof e[0]&&removeSubscribers();for(var t,r=aslice.call(arguments,1),n=e.length;t=e[--n];){var a=t.element;if(a&&a.parentNode)if(t.$repeat)t.handler.apply(t,r);else if("on"!==t.type){var o=t.evaluator||noop;t.handler(o.apply(0,t.args||[]),a,t)}}}}function checkScan(e,t,r){var n=setTimeout(function(){var a=e.innerHTML;clearTimeout(n),a===r?t():checkScan(e,t,a)})}function createSignalTower(e,t){var r=e.getAttribute("avalonctrl")||t.$id;e.setAttribute("avalonctrl",r),t.$events.expr=e.tagName+'[avalonctrl="'+r+'"]'}function executeBindings(e,t){for(var r,n=0;r=e[n++];)r.vmodels=t,bindingHandlers[r.type](r,t),r.evaluator&&r.element&&1===r.element.nodeType&&r.element.removeAttribute(r.name);e.length=0}function bindingSorter(e,t){return e.priority-t.priority}function scanAttr(e,t){for(var r,n,a=e.hasAttributes()?avalon.slice(e.attributes):[],o=[],i=createMap(),s=0;n=a[s++];)if(n.specified&&(r=n.name.match(rmsAttr))){var l=r[1],c=r[2]||"",u=n.value,p=n.name;if(i[p]=u,events[l]?(c=l,l="on"):obsoleteAttrs[l]&&(log("warning!请改用ms-attr-"+l+"代替ms-"+l+"！"),"enabled"===l&&(log("warning!ms-enabled或ms-attr-enabled已经被废弃"),l="disabled",u="!("+u+")"),c=l,l="attr",e.removeAttribute(p),p="ms-attr-"+c,e.setAttribute(p,u),r=[p],i[p]=u),"function"==typeof bindingHandlers[l]){var d={type:l,param:c,element:e,name:r[0],value:u,priority:l in priorityMap?priorityMap[l]:10*l.charCodeAt(0)+(Number(c)||0)};if("html"===l||"text"===l){var f=getToken(u);avalon.mix(d,f),d.filters=d.filters.replace(rhasHtml,function(){return d.type="html",d.group=1,""})}"ms-if-loop"===p&&(d.priority+=100),t.length&&(o.push(d),"widget"===l&&(e.msData=e.msData||i))}}var v=e.type;v&&i["ms-duplex"]&&(i["ms-attr-checked"]&&/radio|checkbox/.test(v)&&log("warning!"+v+"控件不能同时定义ms-attr-checked与ms-duplex"),i["ms-attr-value"]&&/text|password/.test(v)&&log("warning!"+v+"控件不能同时定义ms-attr-value与ms-duplex")),o.sort(bindingSorter);var h=!0;for(s=0;d=o[s];s++){if(l=d.type,rnoscanAttrBinding.test(l))return executeBindings(o.slice(0,s+1),t);h&&(h=!rnoscanNodeBinding.test(l))}executeBindings(o,t),h&&!stopScan[e.tagName]&&rbind.test(e.innerHTML+e.textContent)&&(mergeTextNodes&&mergeTextNodes(e),scanNodeList(e,t))}function scanNodeList(e,t){for(var r=e.firstChild;r;){var n=r.nextSibling;scanNode(r,r.nodeType,t),r=n}}function scanNodeArray(e,t){for(var r,n=0;r=e[n++];)scanNode(r,r.nodeType,t)}function scanNode(e,t,r){1===t?(scanTag(e,r),e.msCallback&&(e.msCallback(),e.msCallback=void 0)):3===t&&rexpr.test(e.data)?scanText(e,r):kernel.commentInterpolate&&8===t&&!rexpr.test(e.nodeValue)&&scanText(e,r)}function scanTag(e,t,r){var n=e.getAttribute("ms-skip"),a=e.getAttributeNode("ms-important"),o=e.getAttributeNode("ms-controller");if("string"!=typeof n){if(r=a||o){var i=avalon.vmodels[r.value];if(!i)return;t=r===a?[i]:[i].concat(t),e.removeAttribute(r.name),e.classList.remove(r.name),createSignalTower(e,i)}scanAttr(e,t)}}function getToken(e){if(e.indexOf("|")>0){var t=e.replace(rstringLiteral,function(e){return Array(e.length+1).join("1")}),r=t.replace(r11a,"ᄢ㍄").indexOf("|");if(r>-1)return{filters:e.slice(r),value:e.slice(0,r),expr:!0}}return{value:e,filters:"",expr:!0}}function scanExpr(e){for(var t,r,n=[],a=0;;){if(r=e.indexOf(openTag,a),-1===r)break;if(t=e.slice(a,r),t&&n.push({value:t,filters:"",expr:!1}),a=r+openTag.length,r=e.indexOf(closeTag,a),-1===r)break;t=e.slice(a,r),t&&n.push(getToken(t)),a=r+closeTag.length}return t=e.slice(a),t&&n.push({value:t,expr:!1,filters:""}),n}function scanText(e,t){var r=[];if(8===e.nodeType)var n=getToken(e.nodeValue),a=[n];else a=scanExpr(e.data);if(a.length){for(var o=0;n=a[o++];){var i=DOC.createTextNode(n.value);n.expr&&(n.type="text",n.element=i,n.filters=n.filters.replace(rhasHtml,function(){return n.type="html",n.group=1,""}),r.push(n)),hyperspace.appendChild(i)}e.parentNode.replaceChild(hyperspace,e),r.length&&executeBindings(r,t)}}function hyphen(e){return e.replace(/([a-z\d])([A-Z]+)/g,"$1-$2").toLowerCase()}function camelize(e){return e.indexOf("-")<0&&e.indexOf("_")<0?e:e.replace(/[-_][^-_]/g,function(e){return e.charAt(1).toUpperCase()})}function parseData(e){try{if("object"==typeof e)return e;e="true"===e?!0:"false"===e?!1:"null"===e?null:+e+""===e?+e:rbrace.test(e)?JSON.parse(e):e}catch(t){}return e}function getWindow(e){return e.window&&e.document?e:9===e.nodeType?e.defaultView:!1}function showHidden(e,t){if(e.offsetWidth<=0){var r=getComputedStyle(e,null);if(rdisplayswap.test(r.display)){var n={node:e};for(var a in cssShow)n[a]=r[a],e.style[a]=cssShow[a];t.push(n)}var o=e.parentNode;o&&1===o.nodeType&&showHidden(o,t)}}function getValType(e){var t=e.tagName.toLowerCase();return"input"===t&&/checkbox|radio/.test(e.type)?"checked":t}function addAssign(e,t,r,n){for(var a,o=[],i=" = "+r+".",s=/\$proxy\$each/.test(t.$id),l=e.length;a=e[--l];){var c=s&&t.$map[a]?"el":a;t.hasOwnProperty(c)&&(o.push(a+i+c),n.vars.push(a),"duplex"===n.type&&(e.get=r+"."+c),e.splice(l,1))}return o}function uniqSet(e){for(var t=[],r={},n=0;n<e.length;n++){var a=e[n],o=a&&"string"==typeof a.$id?a.$id:a;r[o]||(r[o]=t.push(a))}return t}function parseFilter(e,t){return t=t.replace(rthimRightParentheses,"").replace(rthimOtherParentheses,function(){return"],|"}).replace(rquoteFilterName,function(e,t){return"["+quote(t)}).replace(rpatchBracket,function(){return'"],["'}).replace(rthimLeftParentheses,function(){return'",'})+"]","return avalon.filters.$filter("+e+", "+t+")"}function parseExpr(e,t,r){var n=r.type,a=r.filters||"",o=t.map(function(e){return String(e.$id).replace(rproxy,"$1")})+e+n+a,i=getVariables(e).concat(),s=[],l=[],c=[],u="";t=uniqSet(t),r.vars=[];for(var p=0,d=t.length;d>p;p++)if(i.length){var f="vm"+expose+"_"+p;l.push(f),c.push(t[p]),s.push.apply(s,addAssign(i,t[p],f,r))}if(s.length||"duplex"!==n){"duplex"!==n&&(e.indexOf("||")>-1||e.indexOf("&&")>-1)&&r.vars.forEach(function(t){var r=new RegExp("\\b"+t+"(?:\\.\\w+|\\[\\w+\\])+","ig");e=e.replace(r,function(r){var n=r.charAt(t.length),a=IEVersion?e.slice(arguments[1]+r.length):RegExp.rightContext,o=/^\s*\(/.test(a);if("."===n||"["===n||o){var i="var"+String(Math.random()).replace(/^0\./,"");if(o){var l=r.split(".");if(l.length>2){var c=l.pop();return s.push(i+" = "+l.join(".")),i+"."+c}return r}return s.push(i+" = "+r),i}return r})}),r.args=c;var v=cacheExprs.get(o);if(v)return void(r.evaluator=v);if(u=s.join(", "),u&&(u="var "+u),/\S/.test(a)){if(!/text|html/.test(r.type))throw Error("ms-"+r.type+"不支持过滤器");e="\nvar ret"+expose+" = "+e+";\r\n",e+=parseFilter("ret"+expose,a)}else{if("duplex"===n){var h="'use strict';\nreturn function(vvv){\n	"+u+";\n	if(!arguments.length){\n		return "+e+"\n	}\n	"+(rduplex.test(e)?e:i.get)+"= vvv;\n} ";try{v=Function.apply(noop,l.concat(h)),r.evaluator=cacheExprs.put(o,v)}catch(m){log("debug: parse error,"+m.message)}return}if("on"===n){-1===e.indexOf("(")?e+=".call(this, $event)":e=e.replace("(",".call(this,"),l.push("$event"),e="\nreturn "+e+";";var g=e.lastIndexOf("\nreturn"),y=e.slice(0,g),b=e.slice(g);e=y+"\n"+b}else e="\nreturn "+e+";"}try{v=Function.apply(noop,l.concat("'use strict';\n"+u+e)),r.evaluator=cacheExprs.put(o,v)}catch(m){log("debug: parse error,"+m.message)}finally{i=s=l=null}}}function parseExprProxy(e,t,r,n,a){Array.isArray(n)&&(e=n.map(function(e){return e.expr?"("+e.value+")":quote(e.value)}).join(" + ")),parseExpr(e,t,r),r.evaluator&&!a&&(r.handler=bindingExecutors[r.handlerName||r.type],avalon.injectBinding(r))}function getTemplateNodes(e,t,r){var n=e.templateCache&&e.templateCache[t];if(n){for(var a,o=DOC.createDocumentFragment();a=n.firstChild;)o.appendChild(a);return o}return avalon.parseHTML(r)}function fixNull(e){return null==e?"":e}function pipe(e,t,r){return t.param.replace(/\w+/g,function(n){var a=avalon.duplexHooks[n];a&&"function"==typeof a[r]&&(e=a[r](e,t))}),e}function ticker(){for(var e=ribbon.length-1;e>=0;e--){var t=ribbon[e];t()===!1&&ribbon.splice(e,1)}ribbon.length||clearInterval(TimerID)}function shimController(e,t,r,n){var a=e.template.cloneNode(!0),o=avalon.slice(a.childNodes);e.$with||a.insertBefore(e.clone.cloneNode(!1),a.firstChild),t.appendChild(a);var i=[r].concat(e.vmodels),s={nodes:o,vmodels:i};n.push(s)}function getComments(e){for(var t=e.element,r=t.nodeValue.replace(":end",""),n=t.previousSibling,a=[];n;)n.nodeValue===r&&a.unshift(n),n=n.previousSibling;return a}function sweepNodes(e,t,r){for(;;){var n=t.previousSibling;if(!n)break;if(n.parentNode.removeChild(n),r&&r.call(n),n===e)break}}function eachProxyFactory(){var e={$index:0,$first:!1,$last:!1,$map:{},$host:[],$outer:{},$remove:avalon.noop,el:{get:function(){var e=this.$events,t=e.$index;e.$index=e.el;try{return this.$host[this.$index]}finally{e.$index=t}},set:function(e){this.$host.set(this.$index,e)}}},t={$last:1,$first:1,$index:1},r=modelFactory(e,t);return r.$id=generateID("$proxy$each"),r}function eachProxyAgent(e,t){var r=eachProxyPool.shift();r||(r=eachProxyFactory());var n=t.length-1;return r.$index=e,r.$first=0===e,r.$last=e===n,r.$map=t.$map,r.$host=t,r.$remove=function(){return t.removeAt(r.$index)},r}function withProxyFactory(){var e=modelFactory({$key:"",$outer:{},$host:{},$val:{get:function(){return this.$host[this.$key]},set:function(e){this.$host[this.$key]=e}}},{$val:1});return e.$id=generateID("$proxy$with"),e}function withProxyAgent(e,t){var r=withProxyPool.pop();r||(r=withProxyFactory());var n=t.$repeat;return r.$key=e,r.$host=n,r.$outer=t.$outer,n.$events?r.$events.$val=n.$events[e]:r.$events={},r}function recycleProxies(e,t){var r="each"===t?eachProxyPool:withProxyPool;avalon.each(e,function(e,t){if(t.$events){for(var n in t.$events)Array.isArray(t.$events[n])&&(t.$events[n].forEach(function(e){"object"==typeof e&&disposeData(e)}),t.$events[n].length=0);t.$host=t.$outer={},r.unshift(t)>kernel.maxRepeatSize&&r.pop()}}),"each"===t&&(e.length=0)}function parseDisplay(e,t){var r="_"+e;if(!parseDisplay[r]){var n=DOC.createElement(e);root.appendChild(n),t=W3C?getComputedStyle(n,null).display:n.currentStyle.display,root.removeChild(n),parseDisplay[r]=t}return parseDisplay[r]}function numberFormat(e,t,r,n){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var a=isFinite(+e)?+e:0,o=isFinite(+t)?Math.abs(t):3,i=n||",",s=r||".",l="",c=function(e,t){var r=Math.pow(10,t);return""+(Math.round(e*r)/r).toFixed(t)};return l=(o?c(a,o):""+Math.round(a)).split("."),l[0].length>3&&(l[0]=l[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,i)),(l[1]||"").length<o&&(l[1]=l[1]||"",l[1]+=new Array(o-l[1].length+1).join("0")),l.join(s)}var expose=Date.now(),DOC=window.document,head=DOC.head;head.insertAdjacentHTML("afterBegin",'<avalon ms-skip class="avalonHide"><style id="avalonStyle">.avalonHide{ display: none!important }</style></avalon>');var ifGroup=head.firstChild,subscribers="$"+expose,otherRequire=window.require,otherDefine=window.define,innerRequire,stopRepeatAssign=!1,rword=/[^, ]+/g,rcomplexType=/^(?:object|array)$/,rsvg=/^\[object SVG\w*Element\]$/,rwindow=/^\[object (?:Window|DOMWindow|global)\]$/,oproto=Object.prototype,ohasOwn=oproto.hasOwnProperty,serialize=oproto.toString,ap=Array.prototype,aslice=ap.slice,Registry={},W3C=window.dispatchEvent,root=DOC.documentElement,hyperspace=DOC.createDocumentFragment(),cinerator=DOC.createElement("div"),class2type={};"Boolean Number String Function Array Date RegExp Object Error".replace(rword,function(e){class2type["[object "+e+"]"]=e.toLowerCase()});var generateID=function(e){return e=e||"avalon",String(Math.random()+Math.random()).replace(/\d\.\d{4}/,e)},IEVersion=IE();avalon=function(e){return new avalon.init(e)},avalon.nextTick=new function(){function e(){for(var e=a.length,t=0;e>t;t++)a[t]();a=a.slice(e)}var t=window.setImmediate,r=window.MutationObserver,n=W3C&&window.postMessage;if(t)return t.bind(window);var a=[];if(r){var o=document.createTextNode("avalon");return new r(e).observe(o,{characterData:!0}),function(e){a.push(e),o.data=Math.random()}}return n?(window.addEventListener("message",function(t){var r=t.source;r!==window&&null!==r||"process-tick"!==t.data||(t.stopPropagation(),e())}),function(e){a.push(e),window.postMessage("process-tick","*")}):function(e){setTimeout(e,0)}},avalon.init=function(e){this[0]=this.element=e},avalon.fn=avalon.prototype=avalon.init.prototype,avalon.type=function(e){return null==e?String(e):"object"==typeof e||"function"==typeof e?class2type[serialize.call(e)]||"object":typeof e};var isFunction=function(e){return"[object Function]"===serialize.call(e)};avalon.isFunction=isFunction,avalon.isWindow=function(e){return rwindow.test(serialize.call(e))},avalon.isPlainObject=function(e){return"[object Object]"===serialize.call(e)&&Object.getPrototypeOf(e)===oproto},avalon.mix=avalon.fn.mix=function(){var e,t,r,n,a,o,i=arguments[0]||{},s=1,l=arguments.length,c=!1;for("boolean"==typeof i&&(c=i,i=arguments[1]||{},s++),"object"==typeof i||isFunction(i)||(i={}),s===l&&(i=this,s--);l>s;s++)if(null!=(e=arguments[s]))for(t in e)r=i[t],n=e[t],i!==n&&(c&&n&&(avalon.isPlainObject(n)||(a=Array.isArray(n)))?(a?(a=!1,o=r&&Array.isArray(r)?r:[]):o=r&&avalon.isPlainObject(r)?r:{},i[t]=avalon.mix(c,o,n)):void 0!==n&&(i[t]=n));return i},avalon.mix({rword:rword,subscribers:subscribers,version:1.43,ui:{},log:log,slice:function(e,t,r){return aslice.call(e,t,r)},noop:noop,error:function(e,t){throw new(t||Error)(e)},oneObject:oneObject,range:function(e,t,r){r||(r=1),null==t&&(t=e||0,e=0);for(var n=-1,a=Math.max(0,Math.ceil((t-e)/r)),o=new Array(a);++n<a;)o[n]=e,e+=r;return o},eventHooks:{},bind:function(e,t,r,n){var a=avalon.eventHooks,o=a[t];return"object"==typeof o&&(t=o.type,o.deel&&(r=o.deel(e,t,r,n))),r.unbind||e.addEventListener(t,r,!!n),r},unbind:function(e,t,r,n){var a=avalon.eventHooks,o=a[t],i=r||noop;"object"==typeof o&&(t=o.type,o.deel&&(r=o.deel(e,t,r,!1))),e.removeEventListener(t,i,!!n)},css:function(e,t,r){e instanceof avalon&&(e=e[0]);var n,a=/[_-]/.test(t)?camelize(t):t;if(t=avalon.cssName(a)||a,void 0===r||"boolean"==typeof r){n=cssHooks[a+":get"]||cssHooks["@:get"],"background"===t&&(t="backgroundColor");var o=n(e,t);return r===!0?parseFloat(o)||0:o}if(""===r)e.style[t]="";else{if(null==r||r!==r)return;isFinite(r)&&!avalon.cssNumber[a]&&(r+="px"),n=cssHooks[a+":set"]||cssHooks["@:set"],n(e,t,r)}},each:function(e,t){if(e){var r=0;if(isArrayLike(e))for(var n=e.length;n>r&&t(r,e[r])!==!1;r++);else for(r in e)if(e.hasOwnProperty(r)&&t(r,e[r])===!1)break}},getWidgetData:function(e,t){var r=avalon(e).data(),n={};for(var a in r)0===a.indexOf(t)&&(n[a.replace(t,"").replace(/\w/,function(e){return e.toLowerCase()})]=r[a]);return n},Array:{ensure:function(e,t){return-1===e.indexOf(t)?e.push(t):void 0},removeAt:function(e,t){return!!e.splice(t,1).length},remove:function(e,t){var r=e.indexOf(t);return~r?avalon.Array.removeAt(e,r):!1}}});var bindingHandlers=avalon.bindingHandlers={},bindingExecutors=avalon.bindingExecutors={},Cache=new function(){function e(e){this.size=0,this.limit=e,this.head=this.tail=void 0,this._keymap={}}var t=e.prototype;return t.put=function(e,t){var r={key:e,value:t};return this._keymap[e]=r,this.tail?(this.tail.newer=r,r.older=this.tail):this.head=r,this.tail=r,this.size===this.limit?this.shift():this.size++,t},t.shift=function(){var e=this.head;e&&(this.head=this.head.newer,this.head.older=e.newer=e.older=this._keymap[e.key]=void 0)},t.get=function(e){var t=this._keymap[e];if(void 0!==t)return t===this.tail?t.value:(t.newer&&(t===this.head&&(this.head=t.newer),t.newer.older=t.older),t.older&&(t.older.newer=t.newer),t.newer=void 0,t.older=this.tail,this.tail&&(this.tail.newer=t),this.tail=t,t.value)},e};if(DOC.contains||(Node.prototype.contains=function(e){return!!(16&this.compareDocumentPosition(e))}),avalon.contains=function(e,t){try{for(;t=t.parentNode;)if(t===e)return!0;return!1}catch(r){return!1}},window.SVGElement){var svgns="http://www.w3.org/2000/svg",svg=DOC.createElementNS(svgns,"svg");svg.innerHTML='<circle cx="50" cy="50" r="40" fill="red" />',rsvg.test(svg.firstChild)||Object.defineProperties(SVGElement.prototype,{outerHTML:{enumerable:!0,configurable:!0,get:function(){return(new XMLSerializer).serializeToString(this)},set:function(e){var t=this.tagName.toLowerCase(),r=this.parentNode,n=avalon.parseHTML(e);if("svg"===t)r.insertBefore(n,this);else{var a=DOC.createDocumentFragment();enumerateNode(n,a),r.insertBefore(a,this)}r.removeChild(this)}},innerHTML:{enumerable:!0,configurable:!0,get:function(){var e=this.outerHTML,t=new RegExp("<"+this.nodeName+'\\b(?:(["\'])[^"]*?(\\1)|[^>])*>',"i"),r=new RegExp("</"+this.nodeName+">$","i");return e.replace(t,"").replace(r,"")},set:function(e){if(avalon.clearHTML){avalon.clearHTML(this);var t=avalon.parseHTML(e);enumerateNode(t,this)}}}})}var eventHooks=avalon.eventHooks;"onmouseenter"in root||avalon.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){eventHooks[e]={type:t,deel:function(t,r,n){return function(r){var a=r.relatedTarget;return a&&(a===t||16&t.compareDocumentPosition(a))?void 0:(delete r.type,r.type=e,n.call(t,r))}}}}),avalon.each({AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"},function(e,t){window[e]&&!eventHooks.animationend&&(eventHooks.animationend={type:t})}),void 0===DOC.onmousewheel&&(eventHooks.mousewheel={type:"wheel",deel:function(e,t,r){return function(t){t.wheelDeltaY=t.wheelDelta=t.deltaY>0?-120:120,t.wheelDeltaX=0,Object.defineProperty(t,"type",{value:"mousewheel"}),r.call(e,t)}}});var openTag,closeTag,rexpr,rexprg,rbind,rregexp=/[-.*+?^${}()|[\]\/\\]/g,plugins={loader:function(e){var t=innerRequire&&e;window.require=t?innerRequire:otherRequire,window.define=t?innerRequire.define:otherDefine},interpolate:function(e){if(openTag=e[0],closeTag=e[1],openTag===closeTag)throw new SyntaxError("openTag!==closeTag");if(e+""=="<!--,-->")kernel.commentInterpolate=!0;else{var t=openTag+"test"+closeTag;if(cinerator.innerHTML=t,cinerator.innerHTML!==t&&cinerator.innerHTML.indexOf("&lt;")>-1)throw new SyntaxError("此定界符不合法");cinerator.innerHTML=""}var r=escapeRegExp(openTag),n=escapeRegExp(closeTag);rexpr=new RegExp(r+"(.*?)"+n),rexprg=new RegExp(r+"(.*?)"+n,"g"),rbind=new RegExp(r+".*?"+n+"|\\sms-")}};kernel.debug=!0,kernel.plugins=plugins,kernel.plugins.interpolate(["{{","}}"]),kernel.paths={},kernel.shim={},kernel.maxRepeatSize=100,avalon.config=kernel;var ravalon=/(\w+)\[(avalonctrl)="(\S+)"\]/,findNodes=function(e){return DOC.querySelectorAll(e)},EventBus={$watch:function(e,t){if("function"==typeof t){var r=this.$events[e];r?r.push(t):this.$events[e]=[t]}else this.$events=this.$watch.backup;return this},$unwatch:function(e,t){var r=arguments.length;if(0===r)this.$watch.backup=this.$events,this.$events={};else if(1===r)this.$events[e]=[];else for(var n=this.$events[e]||[],a=n.length;~--a<0;)if(n[a]===t)return n.splice(a,1);return this},$fire:function(e){var t,r,n,a;/^(\w+)!(\S+)$/.test(e)&&(t=RegExp.$1,e=RegExp.$2);var o=this.$events;if(o){var i=aslice.call(arguments,1),s=[e].concat(i);if("all"===t)for(r in avalon.vmodels)n=avalon.vmodels[r],n!==this&&n.$fire.apply(n,s);else if("up"===t||"down"===t){var l=o.expr?findNodes(o.expr):[];if(0===l.length)return;for(r in avalon.vmodels)if(n=avalon.vmodels[r],n!==this&&n.$events.expr){var c=findNodes(n.$events.expr);if(0===c.length)continue;Array.prototype.forEach.call(c,function(e){Array.prototype.forEach.call(l,function(r){var a="down"===t?r.contains(e):e.contains(r);a&&(e._avalon=n)})})}var u=DOC.getElementsByTagName("*"),p=[];for(Array.prototype.forEach.call(u,function(e){e._avalon&&(p.push(e._avalon),e._avalon="",e.removeAttribute("_avalon"))}),"up"===t&&p.reverse(),r=0;(a=p[r++])&&a.$fire.apply(a,s)!==!1;);}else{var d=o[e]||[],f=o.$all||[];for(r=0;a=d[r++];)isFunction(a)&&a.apply(this,i);for(r=0;a=f[r++];)isFunction(a)&&a.apply(this,arguments)}}}},VMODELS=avalon.vmodels=createMap();avalon.define=function(e,t){var r=e.$id||e;if(r||log("warning: vm必须指定$id"),VMODELS[r]&&log("warning: "+r+" 已经存在于avalon.vmodels中"),"object"==typeof e)var n=modelFactory(e);else{var a={$watch:noop};t(a),n=modelFactory(a),stopRepeatAssign=!0,t(n),stopRepeatAssign=!1}return n.$id=r,VMODELS[r]=n};var $$skipArray=String("$id,$watch,$unwatch,$fire,$events,$model,$skipArray").match(rword),midway=createMap(),isEqual=Object.is||function(e,t){return 0===e&&0===t?1/e===1/t:e!==e?t!==t:e===t},descriptorFactory=function(e){var t=createMap();for(var r in e)t[r]={get:e[r],set:e[r],enumerable:!0,configurable:!0};return t},_splice=ap.splice,CollectionPrototype={_splice:_splice,_fire:function(e,t,r){notifySubscribers(this.$events[subscribers],e,t,r)},size:function(){return this._.length},pushArray:function(e){var t=e.length,r=this.length;return t&&(ap.push.apply(this.$model,e),mutateArray.call(this,"add",r,t,Math.max(0,r-1))),t+r},push:function(){var e,t=[],r=arguments.length;for(e=0;r>e;e++)t[e]=arguments[e];return this.pushArray(t)},unshift:function(){var e=arguments.length,t=this.length;return e&&(ap.unshift.apply(this.$model,arguments),mutateArray.call(this,"add",0,e,0)),e+t},shift:function(){if(this.length){var e=this.$model.shift();return mutateArray.call(this,"del",0,1,0),e}},pop:function(){var e=this.length;if(e){var t=this.$model.pop();return mutateArray.call(this,"del",e-1,1,Math.max(0,e-2)),t}},splice:function(e){var t,r=arguments.length,n=[],a=_splice.apply(this.$model,arguments);return a.length&&(n.push("del",e,a.length,0),t=!0),r>2&&(t?n.splice(3,1,0,"add",e,r-2):n.push("add",e,r-2,0),t=!0),t?mutateArray.apply(this,n):[]},contains:function(e){return-1!==this.indexOf(e)},remove:function(e){return this.removeAt(this.indexOf(e))},removeAt:function(e){return e>=0?(this.$model.splice(e,1),mutateArray.call(this,"del",e,1,0)):[]},clear:function(){return recycleProxies(this.$proxy,"each"),this.$model.length=this.$proxy.length=this.length=this._.length=0,this._fire("clear",0),this},removeAll:function(e){if(Array.isArray(e))e.forEach(function(e){this.remove(e)},this);else if("function"==typeof e)for(var t=this.length-1;t>=0;t--){var r=this[t];e(r,t)&&this.removeAt(t)}else this.clear()},ensure:function(e){return this.contains(e)||this.push(e),this},set:function(e,t){if(e>=0){var r=avalon.type(t);t&&t.$model&&(t=t.$model);var n=this[e];if("object"===r)for(var a in t)n.hasOwnProperty(a)&&(n[a]=t[a]);else if("array"===r)n.clear().push.apply(n,t);else if(n!==t){this[e]=t,this.$model[e]=t;var o=this.$proxy[e];o&&notifySubscribers(o.$events.el)}}return this}};"sort,reverse".replace(rword,function(e){CollectionPrototype[e]=function(){var t,r=this.$model,n=r.concat(),a=Math.random(),o=[];ap[e].apply(r,arguments);for(var i=0,s=n.length;s>i;i++){var l=r[i],c=n[i];if(isEqual(l,c))o.push(i);else{var u=n.indexOf(l);o.push(u),n[u]=a,t=!0}}return t&&(sortByIndex(this,o),sortByIndex(this.$proxy,o),this._fire("move",o),resetIndex(this.$proxy,0)),this}});var ronduplex=/^(duplex|on)$/;avalon.injectBinding=function(e){Registry[expose]=e,avalon.openComputedCollect=!0;var t=e.evaluator;if(t)try{var r=ronduplex.test(e.type)?e:t.apply(0,e.args);e.noRefresh||e.handler(r,e.element,e)}catch(n){delete e.evaluator;var a=e.element;if(3===a.nodeType){var o=a.parentNode;kernel.commentInterpolate?o.replaceChild(DOC.createComment(e.value),a):a.data=openTag+e.value+closeTag}}avalon.openComputedCollect=!1,delete Registry[expose]};var $$subscribers=avalon.$$subscribers=[],beginTime=new Date,oldInfo={},tagHooks=new function(){avalon.mix(this,{option:DOC.createElement("select"),thead:DOC.createElement("table"),td:DOC.createElement("tr"),area:DOC.createElement("map"),tr:DOC.createElement("tbody"),col:DOC.createElement("colgroup"),legend:DOC.createElement("fieldset"),_default:DOC.createElement("div"),g:DOC.createElementNS("http://www.w3.org/2000/svg","svg")}),this.optgroup=this.option,this.tbody=this.tfoot=this.colgroup=this.caption=this.thead,this.th=this.td};String("circle,defs,ellipse,image,line,path,polygon,polyline,rect,symbol,text,use").replace(rword,function(e){tagHooks[e]=tagHooks.g});var rtagName=/<([\w:]+)/,rxhtml=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,scriptTypes=oneObject(["","text/javascript","text/ecmascript","application/ecmascript","application/javascript"]),script=DOC.createElement("script"),rhtml=/<|&#?\w+;/;avalon.parseHTML=function(e){var t=hyperspace.cloneNode(!1);if("string"!=typeof e)return t;if(!rhtml.test(e))return t.appendChild(DOC.createTextNode(e)),t;e=e.replace(rxhtml,"<$1></$2>").trim();var r,n=(rtagName.exec(e)||["",""])[1].toLowerCase(),a=tagHooks[n]||tagHooks._default;a.innerHTML=e;var o=a.getElementsByTagName("script");if(o.length)for(var i,s=0;i=o[s++];)if(scriptTypes[i.type]){var l=script.cloneNode(!1);ap.forEach.call(i.attributes,function(e){l.setAttribute(e.name,e.value)}),l.text=i.text,i.parentNode.replaceChild(l,i)}for(;r=a.firstChild;)t.appendChild(r);return t},avalon.innerHTML=function(e,t){var r=this.parseHTML(t);this.clearHTML(e).appendChild(r)},avalon.clearHTML=function(e){for(e.textContent="";e.firstChild;)e.removeChild(e.firstChild);return e},avalon.scan=function(e,t){e=e||root;var r=t?[].concat(t):[];scanTag(e,r)};var stopScan=oneObject("area,base,basefont,br,col,command,embed,hr,img,input,link,meta,param,source,track,wbr,noscript,script,style,textarea".toUpperCase()),getBindingCallback=function(e,t,r){var n=e.getAttribute(t);if(n)for(var a,o=0;a=r[o++];)if(a.hasOwnProperty(n)&&"function"==typeof a[n])return a[n]},mergeTextNodes=IEVersion&&window.MutationObserver?function(e){for(var t,r=e.firstChild;r;){var n=r.nextSibling;3===r.nodeType?t?(t.nodeValue+=r.nodeValue,e.removeChild(r)):t=r:t=null,r=n}}:0,rmsAttr=/ms-(\w+)-?(.*)/,priorityMap={"if":10,repeat:90,data:100,widget:110,each:1400,"with":1500,duplex:2e3,on:3e3},events=oneObject("animationend,blur,change,input,click,dblclick,focus,keydown,keypress,keyup,mousedown,mouseenter,mouseleave,mousemove,mouseout,mouseover,mouseup,scan,scroll,submit"),obsoleteAttrs=oneObject("value,title,alt,checked,selected,disabled,readonly,enabled"),rnoscanAttrBinding=/^if|widget|repeat$/,rnoscanNodeBinding=/^each|with|html|include$/,rhasHtml=/\|\s*html\s*/,r11a=/\|\|/g,rlt=/&lt;/g,rgt=/&gt;/g,rstringLiteral=/(['"])(\\\1|.)+?\1/g;
"add,remove".replace(rword,function(e){avalon.fn[e+"Class"]=function(t){var r=this[0];return t&&"string"==typeof t&&r&&1===r.nodeType&&t.replace(/\S+/g,function(t){r.classList[e](t)}),this}}),avalon.fn.mix({hasClass:function(e){var t=this[0]||{};return 1===t.nodeType&&t.classList.contains(e)},toggleClass:function(e,t){for(var r,n=0,a=String(e).split(/\s+/),o="boolean"==typeof t;r=a[n++];){var i=o?t:!this.hasClass(r);this[i?"addClass":"removeClass"](r)}return this},attr:function(e,t){return 2===arguments.length?(this[0].setAttribute(e,t),this):this[0].getAttribute(e)},data:function(e,t){switch(e="data-"+hyphen(e||""),arguments.length){case 2:return this.attr(e,t),this;case 1:var r=this.attr(e);return parseData(r);case 0:var n={};return ap.forEach.call(this[0].attributes,function(t){t&&(e=t.name,e.indexOf("data-")||(e=camelize(e.slice(5)),n[e]=parseData(t.value)))}),n}},removeData:function(e){return e="data-"+hyphen(e),this[0].removeAttribute(e),this},css:function(e,t){if(avalon.isPlainObject(e))for(var r in e)avalon.css(this,r,e[r]);else var n=avalon.css(this,e,t);return void 0!==n?n:this},position:function(){var e,t,r=this[0],n={top:0,left:0};if(r)return"fixed"===this.css("position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),"HTML"!==e[0].tagName&&(n=e.offset()),n.top+=avalon.css(e[0],"borderTopWidth",!0),n.left+=avalon.css(e[0],"borderLeftWidth",!0),n.top-=e.scrollTop(),n.left-=e.scrollLeft()),{top:t.top-n.top-avalon.css(r,"marginTop",!0),left:t.left-n.left-avalon.css(r,"marginLeft",!0)}},offsetParent:function(){for(var e=this[0].offsetParent;e&&"static"===avalon.css(e,"position");)e=e.offsetParent;return avalon(e||root)},bind:function(e,t,r){return this[0]?avalon.bind(this[0],e,t,r):void 0},unbind:function(e,t,r){return this[0]&&avalon.unbind(this[0],e,t,r),this},val:function(e){var t=this[0];if(t&&1===t.nodeType){var r=0===arguments.length,n=r?":get":":set",a=valHooks[getValType(t)+n];if(a)var o=a(t,e);else{if(r)return(t.value||"").replace(/\r/g,"");t.value=e}}return r?o:this}}),root.dataset&&(avalon.fn.data=function(e,t){e=e&&camelize(e);var r=this[0].dataset;switch(arguments.length){case 2:return r[e]=t,this;case 1:return t=r[e],parseData(t);case 0:var n=createMap();for(e in r)n[e]=parseData(r[e]);return n}});var rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/;avalon.parseJSON=JSON.parse,avalon.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){avalon.fn[e]=function(r){var n=this[0]||{},a=getWindow(n),o="scrollTop"===e;return arguments.length?void(a?a.scrollTo(o?a[t]:r,o?r:a[t]):n[e]=r):a?a[t]:n[e]}});var cssHooks=avalon.cssHooks=createMap(),prefixes=["","-webkit-","-moz-","-ms-"],cssMap={"float":"cssFloat"};avalon.cssNumber=oneObject("columnCount,order,fillOpacity,fontWeight,lineHeight,opacity,orphans,widows,zIndex,zoom"),avalon.cssName=function(e,t,r){if(cssMap[e])return cssMap[e];t=t||root.style;for(var n=0,a=prefixes.length;a>n;n++)if(r=camelize(prefixes[n]+e),r in t)return cssMap[e]=r;return null},cssHooks["@:set"]=function(e,t,r){e.style[t]=r},cssHooks["@:get"]=function(e,t){if(!e||!e.style)throw new Error("getComputedStyle要求传入一个节点 "+e);var r,n=getComputedStyle(e);return n&&(r="filter"===t?n.getPropertyValue(t):n[t],""===r&&(r=e.style[t])),r},cssHooks["opacity:get"]=function(e){var t=cssHooks["@:get"](e,"opacity");return""===t?"1":t},"top,left".replace(rword,function(e){cssHooks[e+":get"]=function(t){var r=cssHooks["@:get"](t,e);return/px$/.test(r)?r:avalon(t).position()[e]+"px"}});var cssShow={position:"absolute",visibility:"hidden",display:"block"},rdisplayswap=/^(none|table(?!-c[ea]).+)/;"Width,Height".replace(rword,function(e){var t=e.toLowerCase(),r="client"+e,n="scroll"+e,a="offset"+e;cssHooks[t+":get"]=function(t,r,n){var o=-4;"number"==typeof n&&(o=n),r="Width"===e?["Left","Right"]:["Top","Bottom"];var i=t[a];return 2===o?i+avalon.css(t,"margin"+r[0],!0)+avalon.css(t,"margin"+r[1],!0):(0>o&&(i=i-avalon.css(t,"border"+r[0]+"Width",!0)-avalon.css(t,"border"+r[1]+"Width",!0)),-4===o&&(i=i-avalon.css(t,"padding"+r[0],!0)-avalon.css(t,"padding"+r[1],!0)),i)},cssHooks[t+"&get"]=function(e){var r=[];showHidden(e,r);for(var n,a=cssHooks[t+":get"](e),o=0;n=r[o++];){e=n.node;for(var i in n)"string"==typeof n[i]&&(e.style[i]=n[i])}return a},avalon.fn[t]=function(o){var i=this[0];if(0===arguments.length){if(i.setTimeout)return i["inner"+e];if(9===i.nodeType){var s=i.documentElement;return Math.max(i.body[n],s[n],i.body[a],s[a],s[r])}return cssHooks[t+"&get"](i)}return this.css(t,o)},avalon.fn["inner"+e]=function(){return cssHooks[t+":get"](this[0],void 0,-2)},avalon.fn["outer"+e]=function(e){return cssHooks[t+":get"](this[0],void 0,e===!0?2:0)}}),avalon.fn.offset=function(){var e=this[0];try{var t=e.getBoundingClientRect();if(t.width||t.height||e.getClientRects().length){var r=e.ownerDocument,n=r.documentElement,a=r.defaultView;return{top:t.top+a.pageYOffset-n.clientTop,left:t.left+a.pageXOffset-n.clientLeft}}}catch(o){return{left:0,top:0}}};var valHooks={"select:get":function(e,t){for(var r,n=e.options,a=e.selectedIndex,o="select-one"===e.type||0>a,i=o?null:[],s=o?a+1:n.length,l=0>a?s:o?a:0;s>l;l++)if(r=n[l],(r.selected||l===a)&&!r.disabled){if(t=r.value,o)return t;i.push(t)}return i},"select:set":function(e,t,r){t=[].concat(t);for(var n,a=0;n=e.options[a++];)(n.selected=t.indexOf(n.value)>-1)&&(r=!0);r||(e.selectedIndex=-1)}},quote=JSON.stringify,keywords=["break,case,catch,continue,debugger,default,delete,do,else,false","finally,for,function,if,in,instanceof,new,null,return,switch,this","throw,true,try,typeof,var,void,while,with","abstract,boolean,byte,char,class,const,double,enum,export,extends","final,float,goto,implements,import,int,interface,long,native","package,private,protected,public,short,static,super,synchronized","throws,transient,volatile","arguments,let,yield,undefined"].join(","),rrexpstr=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|[\s\t\n]*\.[\s\t\n]*[$\w\.]+/g,rsplit=/[^\w$]+/g,rkeywords=new RegExp(["\\b"+keywords.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),rnumber=/\b\d[^,]*/g,rcomma=/^,+|,+$/g,cacheVars=new Cache(512),getVariables=function(e){var t=","+e.trim(),r=cacheVars.get(t);if(r)return r;var n=e.replace(rrexpstr,"").replace(rsplit,",").replace(rkeywords,"").replace(rnumber,"").replace(rcomma,"").split(/^$|,+/);return cacheVars.put(t,uniqSet(n))},cacheExprs=new Cache(128),rduplex=/\w\[.*\]|\w\.\w/,rproxy=/(\$proxy\$[a-z]+)\d+$/,rthimRightParentheses=/\)\s*$/,rthimOtherParentheses=/\)\s*\|/g,rquoteFilterName=/\|\s*([$\w]+)/g,rpatchBracket=/"\s*\["/g,rthimLeftParentheses=/"\s*\(/g;avalon.parseExprProxy=parseExprProxy;var bools=["autofocus,autoplay,async,allowTransparency,checked,controls","declare,disabled,defer,defaultChecked,defaultSelected","contentEditable,isMap,loop,multiple,noHref,noResize,noShade","open,readOnly,selected"].join(","),boolMap={};bools.replace(rword,function(e){boolMap[e.toLowerCase()]=e});var propMap={"accept-charset":"acceptCharset","char":"ch",charoff:"chOff","class":"className","for":"htmlFor","http-equiv":"httpEquiv"},anomaly=["accessKey,bgColor,cellPadding,cellSpacing,codeBase,codeType,colSpan","dateTime,defaultValue,frameBorder,longDesc,maxLength,marginWidth,marginHeight","rowSpan,tabIndex,useMap,vSpace,valueType,vAlign"].join(",");anomaly.replace(rword,function(e){propMap[e.toLowerCase()]=e});var rnoscripts=/<noscript.*?>(?:[\s\S]+?)<\/noscript>/gim,rnoscriptText=/<noscript.*?>([\s\S]+?)<\/noscript>/im,getXHR=function(){return new(window.XMLHttpRequest||ActiveXObject)("Microsoft.XMLHTTP")},cacheTmpls=avalon.templateCache={};bindingHandlers.attr=function(e,t){var r=e.value.trim(),n=!0;if(r.indexOf(openTag)>-1&&r.indexOf(closeTag)>2&&(n=!1,rexpr.test(r)&&""===RegExp.rightContext&&""===RegExp.leftContext&&(n=!0,r=RegExp.$1)),"include"===e.type){var a=e.element;e.includeRendered=getBindingCallback(a,"data-include-rendered",t),e.includeLoaded=getBindingCallback(a,"data-include-loaded",t);var o=e.includeReplace=!!avalon(a).data("includeReplace");avalon(a).data("includeCache")&&(e.templateCache={}),e.startInclude=DOC.createComment("ms-include"),e.endInclude=DOC.createComment("ms-include-end"),o?(e.element=e.startInclude,a.parentNode.insertBefore(e.startInclude,a),a.parentNode.insertBefore(e.endInclude,a.nextSibling)):(a.insertBefore(e.startInclude,a.firstChild),a.appendChild(e.endInclude))}e.handlerName="attr",parseExprProxy(r,t,e,n?0:scanExpr(e.value))},bindingExecutors.attr=function(e,t,r){var n=r.type,a=r.param;if("css"===n)avalon(t).css(a,e);else if("attr"===n){var o=e===!1||null===e||void 0===e;!W3C&&propMap[a]&&(a=propMap[a]);var i=boolMap[a];if("boolean"==typeof t[i]&&(t[i]=!!e,e||(o=!0)),o)return t.removeAttribute(a);var s=rsvg.test(t)?!1:DOC.namespaces&&isVML(t)?!0:a in t.cloneNode(!1);s?t[a]=e:t.setAttribute(a,e)}else if("include"===n&&e){var l=r.vmodels,c=r.includeRendered,u=r.includeLoaded,p=r.includeReplace,d=p?t.parentNode:t,f=function(t){if(u){var n=u.apply(d,[t].concat(l));"string"==typeof n&&(t=n)}c&&checkScan(d,function(){c.call(d)},0/0);var a=r.includeLastID;if(r.templateCache&&a&&a!==e){var o=r.templateCache[a];o||(o=r.templateCache[a]=DOC.createElement("div"),ifGroup.appendChild(o))}for(r.includeLastID=e;;){var i=r.startInclude.nextSibling;if(!i||i===r.endInclude)break;d.removeChild(i),o&&o.appendChild(i)}var s=getTemplateNodes(r,e,t),p=avalon.slice(s.childNodes);d.insertBefore(s,r.endInclude),scanNodeArray(p,l)};if("src"===r.param)if("string"==typeof cacheTmpls[e])avalon.nextTick(function(){f(cacheTmpls[e])});else if(Array.isArray(cacheTmpls[e]))cacheTmpls[e].push(f);else{var v=getXHR();v.onreadystatechange=function(){if(4===v.readyState){var t=v.status;if(t>=200&&300>t||304===t||1223===t){for(var r,n=v.responseText,a=0;r=cacheTmpls[e][a++];)r(n);cacheTmpls[e]=n}}},cacheTmpls[e]=[f],v.open("GET",e,!0),"withCredentials"in v&&(v.withCredentials=!0),v.setRequestHeader("X-Requested-With","XMLHttpRequest"),v.send(null)}else{var h=e&&1===e.nodeType?e:DOC.getElementById(e);if(h){if("NOSCRIPT"===h.tagName&&!h.innerHTML&&!h.fixIE78){v=getXHR(),v.open("GET",location,!1),v.send(null);for(var m=DOC.getElementsByTagName("noscript"),g=(v.responseText||"").match(rnoscripts)||[],y=g.length,b=0;y>b;b++){var x=m[b];x&&(x.style.display="none",x.fixIE78=(g[b].match(rnoscriptText)||["","&nbsp;"])[1])}}avalon.nextTick(function(){f(h.fixIE78||h.value||h.innerText||h.innerHTML)})}}}else if(root.hasAttribute||"string"!=typeof e||"src"!==n&&"href"!==n||(e=e.replace(/&amp;/g,"&")),t[n]=e,window.chrome&&"EMBED"===t.tagName){var w=t.parentNode,$=document.createComment("ms-src");w.replaceChild($,t),w.replaceChild(t,$)}},"title,alt,src,value,css,include,href".replace(rword,function(e){bindingHandlers[e]=bindingHandlers.attr}),bindingHandlers["class"]=function(e,t){var r,n=e.param,a=e.value;if(e.handlerName="class",!n||isFinite(n)){e.param="";var o=a.replace(rexprg,function(e){return e.replace(/./g,"0")}),i=o.indexOf(":");if(-1===i)var s=a;else{if(s=a.slice(0,i),r=a.slice(i+1),parseExpr(r,t,e),!e.evaluator)return log("debug: ms-class '"+(r||"").trim()+"' 不存在于VM中"),!1;e._evaluator=e.evaluator,e._args=e.args}var l=rexpr.test(s);l||(e.immobileClass=s),parseExprProxy("",t,e,l?scanExpr(s):0)}else e.immobileClass=e.oldStyle=e.param,parseExprProxy(a,t,e)},bindingExecutors["class"]=function(e,t,r){var n=avalon(t),a=r.type;if("class"===a&&r.oldStyle)n.toggleClass(r.oldStyle,!!e);else switch(r.toggleClass=r._evaluator?!!r._evaluator.apply(t,r._args):!0,r.newClass=r.immobileClass||e,r.oldClass&&r.newClass!==r.oldClass&&n.removeClass(r.oldClass),r.oldClass=r.newClass,a){case"class":n.toggleClass(r.newClass,r.toggleClass);break;case"hover":case"active":if(!r.hasBindEvent){var o="mouseenter",i="mouseleave";if("active"===a){t.tabIndex=t.tabIndex||-1,o="mousedown",i="mouseup";var s=n.bind("mouseleave",function(){r.toggleClass&&n.removeClass(r.newClass)})}var l=n.bind(o,function(){r.toggleClass&&n.addClass(r.newClass)}),c=n.bind(i,function(){r.toggleClass&&n.removeClass(r.newClass)});r.rollback=function(){n.unbind("mouseleave",s),n.unbind(o,l),n.unbind(i,c)},r.hasBindEvent=!0}}},"hover,active".replace(rword,function(e){bindingHandlers[e]=bindingHandlers["class"]}),bindingExecutors.data=function(e,t,r){var n="data-"+r.param;e&&"object"==typeof e?t[n]=e:t.setAttribute(n,String(e))};var duplexBinding=bindingHandlers.duplex=function(e,t){var r,n=e.element;if(parseExprProxy(e.value,t,e,0,1),e.changed=getBindingCallback(n,"data-duplex-changed",t)||noop,e.evaluator&&e.args){var a=[],o=oneObject("string,number,boolean,checked");"radio"===n.type&&""===e.param&&(e.param="checked"),n.msData&&(n.msData["ms-duplex"]=e.value),e.param.replace(/\w+/g,function(t){/^(checkbox|radio)$/.test(n.type)&&/^(radio|checked)$/.test(t)&&("radio"===t&&log("ms-duplex-radio已经更名为ms-duplex-checked"),t="checked",e.isChecked=!0),"bool"===t?(t="boolean",log("ms-duplex-bool已经更名为ms-duplex-boolean")):"text"===t&&(t="string",log("ms-duplex-text已经更名为ms-duplex-string")),o[t]&&(r=!0),avalon.Array.ensure(a,t)}),r||a.push("string"),e.param=a.join("-"),e.bound=function(t,r){n.addEventListener?n.addEventListener(t,r,!1):n.attachEvent("on"+t,r);var a=e.rollback;e.rollback=function(){n.avalonSetter=null,avalon.unbind(n,t,r),a&&a()}};for(var i in avalon.vmodels){var s=avalon.vmodels[i];s.$fire("avalon-ms-duplex-init",e)}var l=e.pipe||(e.pipe=pipe);l(null,e,"init");var c=n.tagName;duplexBinding[c]&&duplexBinding[c](n,e.evaluator.apply(null,e.args),e)}};avalon.duplexHooks={checked:{get:function(e,t){return!t.element.oldValue}},string:{get:function(e){return e},set:fixNull},"boolean":{get:function(e){return"true"===e},set:fixNull},number:{get:function(e,t){var r=parseFloat(e);if(-e===-r)return r;var n=/strong|medium|weak/.exec(t.element.getAttribute("data-duplex-number"))||["medium"];switch(n[0]){case"strong":return 0;case"medium":return""===e?"":0;case"weak":return e}},set:fixNull}};var TimerID,ribbon=[];avalon.tick=function(e){1===ribbon.push(e)&&(TimerID=setInterval(ticker,60))};var watchValueInTimer=noop,rmsinput=/text|password|hidden/;!new function(){function e(e){if(avalon.contains(root,this)){if(t[this.tagName].call(this,e),!rmsinput.test(this.type))return;!this.msFocus&&this.avalonSetter&&this.avalonSetter()}}try{var t={},r=HTMLInputElement.prototype,n=HTMLTextAreaElement.prototype,a=HTMLInputElement.prototype;Object.getOwnPropertyNames(a),t.INPUT=Object.getOwnPropertyDescriptor(r,"value").set,Object.defineProperty(r,"value",{set:e}),t.TEXTAREA=Object.getOwnPropertyDescriptor(n,"value").set,Object.defineProperty(n,"value",{set:e})}catch(o){watchValueInTimer=avalon.tick}},duplexBinding.INPUT=function(e,t,r){function n(e){r.changed.call(this,e,r)}function a(){c=!0}function o(){c=!1}var i=e.type,s=r.bound,l=avalon(e),c=!1,u=function(){if(!c){var a=e.oldValue=e.value,o=r.pipe(a,r,"get");l.data("duplexObserve")!==!1&&(t(o),n.call(e,o),l.data("duplex-focus")&&avalon.nextTick(function(){e.focus()}))}};if(r.handler=function(){var n=r.pipe(t(),r,"set")+"";n!==e.oldValue&&(e.value=n)},r.isChecked||"radio"===i)u=function(){if(l.data("duplexObserve")!==!1){var a=r.pipe(e.value,r,"get");t(a),n.call(e,a)}},r.handler=function(){var n=t(),a=r.isChecked?!!n:n+""===e.value;e.checked=e.oldValue=a},s("click",u);else if("checkbox"===i)u=function(){if(l.data("duplexObserve")!==!1){var a=e.checked?"ensure":"remove",o=t();Array.isArray(o)||(log("ms-duplex应用于checkbox上要对应一个数组"),o=[o]),avalon.Array[a](o,r.pipe(e.value,r,"get")),n.call(e,o)}},r.handler=function(){var n=[].concat(t());e.checked=n.indexOf(r.pipe(e.value,r,"get"))>-1},s("change",u);else{var p=e.getAttribute("data-duplex-event")||"input";e.attributes["data-event"]&&log("data-event指令已经废弃，请改用data-duplex-event"),p.replace(rword,function(e){switch(e){case"input":s("input",u),s("DOMAutoComplete",u),IEVersion||(s("compositionstart",a),s("compositionend",o));break;default:s(e,u)}}),s("focus",function(){e.msFocus=!0}),s("blur",function(){e.msFocus=!1}),rmsinput.test(i)&&watchValueInTimer(function(){if(root.contains(e))e.msFocus||e.oldValue===e.value||u();else if(!e.msRetain)return!1}),e.avalonSetter=u}e.oldValue=e.value,avalon.injectBinding(r),n.call(e,e.value)},duplexBinding.TEXTAREA=duplexBinding.INPUT,duplexBinding.SELECT=function(e,t,r){function n(){if(a.data("duplexObserve")!==!1){var n=a.val();n=Array.isArray(n)?n.map(function(e){return r.pipe(e,r,"get")}):r.pipe(n,r,"get"),n+""!==e.oldValue&&t(n),r.changed.call(e,n,r)}}var a=avalon(e);r.handler=function(){var r=t();r=r&&r.$model||r,Array.isArray(r)?e.multiple||log("ms-duplex在<select multiple=true>上要求对应一个数组"):e.multiple&&log("ms-duplex在<select multiple=false>不能对应一个数组"),r=Array.isArray(r)?r.map(String):r+"",r+""!==e.oldValue&&(a.val(r),e.oldValue=r+"")},r.bound("change",n),e.msCallback=function(){avalon.injectBinding(r),r.changed.call(e,t(),r)}},bindingExecutors.html=function(e,t,r){e=null==e?"":e;var n="group"in r,a=n?t.parentNode:t;if(a){if("string"==typeof e)var o=avalon.parseHTML(e);else if(11===e.nodeType)o=e;else if(1===e.nodeType||e.item){var i=1===e.nodeType?e.childNodes:e.item;for(o=hyperspace.cloneNode(!0);i[0];)o.appendChild(i[0])}if(o.firstChild||o.appendChild(DOC.createComment("ms-html")),i=avalon.slice(o.childNodes),n){var s=r.group,l=1;for(r.group=i.length,r.element=i[0];s>l;){var c=t.nextSibling;c&&(a.removeChild(c),l++)}a.replaceChild(o,t)}else avalon.clearHTML(a).appendChild(o);scanNodeArray(i,r.vmodels)}},bindingHandlers["if"]=bindingHandlers.data=bindingHandlers.text=bindingHandlers.html=function(e,t){parseExprProxy(e.value,t,e)},bindingExecutors["if"]=function(e,t,r){if(e)8===t.nodeType&&(t.parentNode.replaceChild(r.template,t),t=r.element=r.template),t.getAttribute(r.name)&&(t.removeAttribute(r.name),scanAttr(t,r.vmodels)),r.rollback=null;else if(1===t.nodeType){var n=r.element=DOC.createComment("ms-if");t.parentNode.replaceChild(n,t),r.template=t,ifGroup.appendChild(t),r.rollback=function(){t.parentNode===ifGroup&&ifGroup.removeChild(t)}}};var rdash=/\(([^)]*)\)/;bindingHandlers.on=function(e,t){var r=e.value;e.type="on";var n=e.param.replace(/-\d+$/,"");if("function"==typeof bindingHandlers.on[n+"Hook"]&&bindingHandlers.on[n+"Hook"](e),r.indexOf("(")>0&&r.indexOf(")")>-1){var a=(r.match(rdash)||["",""])[1].trim();(""===a||"$event"===a)&&(r=r.replace(rdash,""))}parseExprProxy(r,t,e)},bindingExecutors.on=function(e,t,r){e=function(e){var t=r.evaluator||noop;return t.apply(this,r.args.concat(e))};var n=r.param.replace(/-\d+$/,"");if("scan"===n)e.call(t,{type:n});else if("function"==typeof r.specialBind)r.specialBind(t,e);else var a=avalon.bind(t,n,e);r.rollback=function(){"function"==typeof r.specialUnbind?r.specialUnbind():avalon.unbind(t,n,a)}},bindingHandlers.repeat=function(e,t){var r=e.type;parseExprProxy(e.value,t,e,0,1);var n=!1;try{var a=e.$repeat=e.evaluator.apply(0,e.args||[]),o=avalon.type(a);"object"!==o&&"array"!==o&&(n=!0,avalon.log("warning:"+e.value+"只能是对象或数组"))}catch(i){n=!0}var s=e.value.split(".")||[];if(s.length>1){s.pop();for(var l,c=s[0],u=0;l=t[u++];)if(l&&l.hasOwnProperty(c)){var p=l[c].$events||{};p[subscribers]=p[subscribers]||[],p[subscribers].push(e);break}}var d=e.element;d.removeAttribute(e.name),e.sortedCallback=getBindingCallback(d,"data-with-sorted",t),e.renderedCallback=getBindingCallback(d,"data-"+r+"-rendered",t);var f=generateID(r),v=e.element=DOC.createComment(f+":end");if(e.clone=DOC.createComment(f),hyperspace.appendChild(v),"each"===r||"with"===r?(e.template=d.innerHTML.trim(),avalon.clearHTML(d).appendChild(v)):(e.template=d.outerHTML.trim(),d.parentNode.replaceChild(v,d)),e.template=avalon.parseHTML(e.template),e.rollback=function(){var t=e.element;if(t){bindingExecutors.repeat.call(e,"clear");var r=t.parentNode,n=e.template,a=n.firstChild;r.replaceChild(n,t);var o=e.$with;o&&o.parentNode&&o.parentNode.removeChild(o),a=e.element="repeat"===e.type?a:r}},!n){e.handler=bindingExecutors.repeat,e.$outer={};var h="$key",m="$val";for(Array.isArray(a)&&(a.$map[e.param||"el"]=1,h="$first",m="$last"),u=0;l=t[u++];)if(l.hasOwnProperty(h)&&l.hasOwnProperty(m)){e.$outer=l;break}var g=a.$events,y=(g||{})[subscribers];if(y&&avalon.Array.ensure(y,e)&&addSubscribers(e,y),"object"===o){e.$with=!0;var b=g?g.$withProxyPool||(g.$withProxyPool={}):{};e.handler("append",a,b)}else a.length&&e.handler("add",0,a.length)}},bindingExecutors.repeat=function(e,t,r){if(e){var n,a,o=this,i=o.element,s=getComments(o),l=i.parentNode,c=hyperspace.cloneNode(!1);switch(e){case"add":for(var u=t+r,p=[],d=o.$repeat,f=t;u>f;f++){var v=d.$proxy[f];v.$outer=o.$outer,shimController(o,c,v,p)}for(l.insertBefore(c,s[t]||i),f=0;a=p[f++];)scanNodeArray(a.nodes,a.vmodels),a.nodes=a.vmodels=null;break;case"del":sweepNodes(s[t],s[t+r]||i);break;case"clear":n=s[0],n&&sweepNodes(n,i);break;case"move":if(n=s[0]){var h,m=n.nodeValue,g=[],y=[];for(sweepNodes(n,i,function(){y.unshift(this),this.nodeValue===m&&(g.unshift(y),y=[])}),sortByIndex(g,t);y=g.shift();)for(;h=y.shift();)c.appendChild(h);l.insertBefore(c,i)}break;case"append":var b=r,x=[];p=[];for(var w in t)t.hasOwnProperty(w)&&"hasOwnProperty"!==w&&x.push(w);if(o.sortedCallback){var $=o.sortedCallback.call(l,x);$&&Array.isArray($)&&$.length&&(x=$)}for(f=0;w=x[f++];)"hasOwnProperty"!==w&&(b[w]||(b[w]=withProxyAgent(w,o)),shimController(o,c,b[w],p));var C=o.$with=o.clone;for(l.insertBefore(C,i),l.insertBefore(c,i),f=0;a=p[f++];)scanNodeArray(a.nodes,a.vmodels),a.nodes=a.vmodels=null}"clear"===e&&(e="del");var k=o.renderedCallback||noop,T=arguments;checkScan(l,function(){k.apply(l,T),l.oldValue&&"SELECT"===l.tagName&&avalon(l).val(l.oldValue.split(","))},0/0)}},"with,each".replace(rword,function(e){bindingHandlers[e]=bindingHandlers.repeat});var eachProxyPool=[],withProxyPool=[];bindingExecutors.text=function(e,t){if(e=null==e?"":e,3===t.nodeType)try{t.data=e}catch(r){}else t.textContent=e},avalon.parseDisplay=parseDisplay,bindingHandlers.visible=function(e,t){var r=avalon(e.element),n=r.css("display");if("none"===n){var a=r[0].style,o=/visibility/i.test(a.cssText),i=r.css("visibility");a.display="",a.visibility="hidden",n=r.css("display"),"none"===n&&(n=parseDisplay(r[0].nodeName)),a.visibility=o?i:""}e.display=n,parseExprProxy(e.value,t,e)},bindingExecutors.visible=function(e,t,r){t.style.display=e?r.display:"none"},bindingHandlers.widget=function(e,t){var r=e.value.match(rword),n=e.element,a=r[0],o=r[1];o&&"$"!==o||(o=generateID(a));var i=r[2]||a,s=avalon.ui[a];if("function"==typeof s){t=n.vmodels||t;for(var l,c=0;l=t[c++];)if(l.hasOwnProperty(i)&&"object"==typeof l[i]){var u=l[i];u=u.$model||u;break}if(u){var p=u[a+"Id"];"string"==typeof p&&(log("warning!不再支持"+a+"Id"),o=p)}var d=avalon.getWidgetData(n,a);e.value=[a,o,i].join(","),e[a+"Id"]=o,e.evaluator=noop,n.msData["ms-widget-id"]=o;var f=e[a+"Options"]=avalon.mix({},s.defaults,u||{},d);n.removeAttribute("ms-widget");var v=s(n,e,t)||{};if(v.$id){avalon.vmodels[o]=v,createSignalTower(n,v);try{v.$init(function(){avalon.scan(n,[v].concat(t)),"function"==typeof f.onInit&&f.onInit.call(n,v,f,t)})}catch(h){}e.rollback=function(){try{v.widgetElement=null,v.$remove()}catch(e){}n.msData={},delete avalon.vmodels[v.$id]},addSubscribers(e,widgetList),window.chrome&&n.addEventListener("DOMNodeRemovedFromDocument",function(){setTimeout(removeSubscribers)})}else avalon.scan(n,t)}else t.length&&(n.vmodels=t)};var widgetList=[],rscripts=/<script[^>]*>([\S\s]*?)<\/script\s*>/gim,ron=/\s+(on[^=\s]+)(?:=("[^"]*"|'[^']*'|[^\s>]+))?/g,ropen=/<\w+\b(?:(["'])[^"]*?(\1)|[^>])*>/gi,rsanitize={a:/\b(href)\=("javascript[^"]*"|'javascript[^']*')/gi,img:/\b(src)\=("javascript[^"]*"|'javascript[^']*')/gi,form:/\b(action)\=("javascript[^"]*"|'javascript[^']*')/gi},rsurrogate=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,rnoalphanumeric=/([^\#-~| |!])/g,filters=avalon.filters={uppercase:function(e){return e.toUpperCase()},lowercase:function(e){return e.toLowerCase()},truncate:function(e,t,r){return t=t||30,r=void 0===r?"...":r,e.length>t?e.slice(0,t-r.length)+r:String(e)},$filter:function(e){for(var t=1,r=arguments.length;r>t;t++){var n=arguments[t],a=avalon.filters[n.shift()];if("function"==typeof a){var o=[e].concat(n);e=a.apply(null,o)}}return e},camelize:camelize,sanitize:function(e){return e.replace(rscripts,"").replace(ropen,function(e){var t=e.toLowerCase().match(/<(\w+)\s/);if(t){var r=rsanitize[t[1]];r&&(e=e.replace(r,function(e,t,r){var n=r.charAt(0);return t+"="+n+"javascript:void(0)"+n}))}return e.replace(ron," ").replace(/\s+/g," ")})},escape:function(e){return String(e).replace(/&/g,"&amp;").replace(rsurrogate,function(e){var t=e.charCodeAt(0),r=e.charCodeAt(1);return"&#"+(1024*(t-55296)+(r-56320)+65536)+";"}).replace(rnoalphanumeric,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")},currency:function(e,t,r){return(t||"￥")+numberFormat(e,isFinite(r)?r:2)},number:numberFormat};!new function(){function e(e){return parseInt(e,10)||0}function t(e,t,r){var n="";for(0>e&&(n="-",e=-e),e=""+e;e.length<t;)e="0"+e;return r&&(e=e.substr(e.length-t)),n+e}function r(e,r,n,a){return function(o){var i=o["get"+e]();return(n>0||i>-n)&&(i+=n),0===i&&-12===n&&(i=12),t(i,r,a)}}function n(e,t){return function(r,n){var a=r["get"+e](),o=(t?"SHORT"+e:e).toUpperCase();return n[o][a]}}function a(e){var r=-1*e.getTimezoneOffset(),n=r>=0?"+":"";return n+=t(Math[r>0?"floor":"ceil"](r/60),2)+t(Math.abs(r%60),2)}function o(e,t){return e.getHours()<12?t.AMPMS[0]:t.AMPMS[1]}var i={yyyy:r("FullYear",4),yy:r("FullYear",2,0,!0),y:r("FullYear",1),MMMM:n("Month"),MMM:n("Month",!0),MM:r("Month",2,1),M:r("Month",1,1),dd:r("Date",2),d:r("Date",1),HH:r("Hours",2),H:r("Hours",1),hh:r("Hours",2,-12),h:r("Hours",1,-12),mm:r("Minutes",2),m:r("Minutes",1),ss:r("Seconds",2),s:r("Seconds",1),sss:r("Milliseconds",3),EEEE:n("Day"),EEE:n("Day",!0),a:o,Z:a},s=/((?:[^yMdHhmsaZE']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z))(.*)/,l=/^\/Date\((\d+)\)\/$/;filters.date=function(t,r){var n,a,o=filters.date.locate,c="",u=[];if(r=r||"mediumDate",r=o[r]||r,"string"==typeof t)if(/^\d+$/.test(t))t=e(t);else if(l.test(t))t=+RegExp.$1;else{var p=t.trim(),d=[0,0,0,0,0,0,0],f=new Date(0);p=p.replace(/^(\d+)\D(\d+)\D(\d+)/,function(t,r,n,a){var o=4===a.length?[a,r,n]:[r,n,a];return d[0]=e(o[0]),d[1]=e(o[1])-1,d[2]=e(o[2]),""});var v=f.setFullYear,h=f.setHours;p=p.replace(/[T\s](\d+):(\d+):?(\d+)?\.?(\d)?/,function(t,r,n,a,o){return d[3]=e(r),d[4]=e(n),d[5]=e(a),o&&(d[6]=Math.round(1e3*parseFloat("0."+o))),""});var m=0,g=0;p=p.replace(/Z|([+-])(\d\d):?(\d\d)/,function(t,r,n,a){return v=f.setUTCFullYear,h=f.setUTCHours,r&&(m=e(r+n),g=e(r+a)),""}),d[3]-=m,d[4]-=g,v.apply(f,d.slice(0,3)),h.apply(f,d.slice(3)),t=f}if("number"==typeof t&&(t=new Date(t)),"date"===avalon.type(t)){for(;r;)a=s.exec(r),a?(u=u.concat(a.slice(1)),r=u.pop()):(u.push(r),r=null);return u.forEach(function(e){n=i[e],c+=n?n(t,o):e.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),c}};var c={AMPMS:{0:"上午",1:"下午"},DAY:{0:"星期日",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},MONTH:{0:"1月",1:"2月",2:"3月",3:"4月",4:"5月",5:"6月",6:"7月",7:"8月",8:"9月",9:"10月",10:"11月",11:"12月"},SHORTDAY:{0:"周日",1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六"},fullDate:"y年M月d日EEEE",longDate:"y年M月d日",medium:"yyyy-M-d H:mm:ss",mediumDate:"yyyy-M-d",mediumTime:"H:mm:ss","short":"yy-M-d ah:mm",shortDate:"yy-M-d",shortTime:"ah:mm"};c.SHORTMONTH=c.MONTH,filters.date.locate=c};var modules=avalon.modules={"domReady!":{exports:avalon,state:3},avalon:{exports:avalon,state:4}};modules.exports=modules.avalon,new function(){function e(e,t){var r="js";e=e.replace(/^(\w+)\!/,function(e,t){return r=t,""}),"ready"===r&&(log("debug: ready!已经被废弃，请使用domReady!"),r="domReady");var n="";e=e.replace(H,function(e){return n=e,""});var a="."+r,o=/js|css/.test(a)?a:"";e=e.replace(/\.[a-z0-9]+$/g,function(e){return e===a?(o=e,""):e});var i=avalon.mix({query:n,ext:o,res:r,name:e,toUrl:p},t);return i.toUrl(e),i}function t(e){var t=e.name,r=e.res,n=modules[t],a=t&&e.urlNoQuery;if(n&&n.state>=1)return t;if(n=modules[a],n&&n.state>=3)return innerRequire(n.deps||[],n.factory,a),a;if(t&&!n){n=modules[a]={id:a,state:1};var i=function(a){M[r]=a,a.load(t,e,function(e){arguments.length&&void 0!==e&&(n.exports=e),n.state=4,o()})};M[r]?i(M[r]):innerRequire([r],i)}return t?a:r+"!"}function r(e,t){for(var n,a=0;n=e[a++];)if(4!==modules[n].state&&(n===t||r(modules[n].deps,t)))return!0}function n(e,t){var r=s(e.src);return e.onload=e.onerror=null,t?(setTimeout(function(){head.removeChild(e),e=null}),void log("debug: 加载 "+r+" 失败"+t+" "+!modules[r].state)):!0}function o(){e:for(var e,t=x.length;e=x[--t];){var r=modules[e],n=r.deps;if(n){for(var a,i=0;a=n[i];i++)if(4!==Object(modules[a]).state)continue e;4!==r.state&&(x.splice(t,1),u(r.id,r.deps,r.factory),o())}}}function i(e,t,r){var a=DOC.createElement("script");a.className=subscribers,a.onload=function(){var n=w.pop();n&&n.require(t),r&&r(),log("debug: 已成功加载 "+e),t&&x.push(t),o()},a.onerror=function(){n(a,!0)},head.insertBefore(a,head.firstChild),a.src=e,log("debug: 正准备加载 "+e)}function s(e){return(e||"").replace(H,"")}function l(e){return/^(?:[a-z]+:)?\/\//i.test(String(e))}function c(){var e;try{a.b.c()}catch(t){e=t.stack}if(e)return e=e.split(/[@ ]/g).pop(),e="("===e[0]?e.slice(1,-1):e.replace(/\s/,""),s(e.replace(/(:\d+)?:\d+$/i,""));for(var r,n=head.getElementsByTagName("script"),o=n.length;r=n[--o];)if(r.className===subscribers&&"interactive"===r.readyState){var i=r.src;return r.className=s(i)}}function u(e,t,r){var n=Object(modules[e]);n.state=4;for(var a,o=0,i=[];a=t[o++];)if("exports"===a){var s=n.exports||(n.exports=createMap());i.push(s)}else i.push(modules[a].exports);try{var l=r.apply(window,i)}catch(c){log("执行["+e+"]模块的factory抛错： "+c)}return void 0!==l&&(n.exports=l),N.test(e)&&delete modules[e],delete n.factory,l}function p(e){0===e.indexOf(this.res+"!")&&(e=e.slice(this.res.length+1));var t=e,r=0,n=this.baseUrl,a=this.parentUrl||n;m(e,kernel.paths,function(e,n){t=t.replace(n,e),r=1}),r||m(e,kernel.packages,function(e,r,n){t=t.replace(n.name,n.location)}),this.mapUrl&&m(this.mapUrl,kernel.map,function(e){m(t,e,function(e,r){t=t.replace(r,e),a=n})});var o=this.ext;o&&r&&t.slice(-o.length)===o&&(t=t.slice(0,-o.length)),l(t)||(a=this.built||/^\w/.test(t)?n:a,t=y(a,t));var i=t+o;return t=i+this.query,m(e,kernel.urlArgs,function(e){t+=(-1===t.indexOf("?")?"?":"&")+e}),this.url=t,this.urlNoQuery=i}function d(e,t,r){var n=h(e,t,r);return n.sort(g),n}function f(e){return new RegExp("^"+e+"(/|$)")}function v(e){return function(){var t;return e.init&&(t=e.init.apply(window,arguments)),t||e.exports&&b(e.exports)}}function h(e,t,r){var n=[];for(var a in e){var o={name:a,val:e[a]};n.push(o),o.reg="*"===a&&t?/^/:f(a),r&&"*"!==a&&(o.reg=new RegExp("/"+a.replace(/^\//,"")+"(/|$)"))}return n}function m(e,t,r){t=t||[];for(var n,a=0;n=t[a++];)if(n.reg.test(e))return r(n.val,n.name,n),!1}function g(e,t){var r=e.name,n=t.name;return"*"===n?-1:"*"===r?1:n.length-r.length}function y(e,t){if("/"!==e.charAt(e.length-1)&&(e+="/"),"./"===t.slice(0,2))return e+t.slice(2);if(".."===t.slice(0,2)){for(e+=t;D.test(e);)e=e.replace(D,"");return e}return"/"===t.slice(0,1)?e+t.slice(1):e+t}function b(e){if(!e)return e;var t=window;return e.split(".").forEach(function(e){t=t[e]}),t}var x=[],w=[],$=/\.js$/i,C=[],k=!1;innerRequire=avalon.require=function(r,n,a,i){if(k){Array.isArray(r)||avalon.error("require方法的第一个参数应为数组 "+r);var s=[],l=createMap(),c=a||"callback"+setTimeout("1");i=i||createMap(),i.baseUrl=kernel.baseUrl;var u=!!i.built;if(a&&(i.parentUrl=a.substr(0,a.lastIndexOf("/")),i.mapUrl=a.replace($,"")),u){var p=e(i.defineName,i);c=p.urlNoQuery}else r.forEach(function(r){var n=e(r,i),a=t(n);a&&(l[a]||(s.push(a),l[a]="司徒正美"))});var d=modules[c];d&&4===d.state||(modules[c]={id:c,deps:u?r.concat():s,factory:n||noop,state:3}),d||x.push(c),o()}else if(C.push(avalon.slice(arguments)),arguments.length<=2){k=!0;for(var f,v=C.splice(0,C.length);f=v.shift();)innerRequire.apply(null,f)}},innerRequire.define=function(e,t,n){"string"!=typeof e&&(n=t,t=e,e="anonymous"),Array.isArray(t)||(n=t,t=[]);
var a={built:!k,defineName:e},o=[t,n,a];n.require=function(e){if(o.splice(2,0,e),modules[e]){modules[e].state=3;var t=!1;try{t=r(modules[e].deps,e)}catch(a){}t&&avalon.error(e+"模块与之前的模块存在循环依赖，请不要直接用script标签引入"+e+"模块")}delete n.require,innerRequire.apply(null,o)};var i=a.built?"unknown":c();if(i){var s=modules[i];s&&(s.state=2),n.require(i)}else w.push(n)},innerRequire.config=kernel,innerRequire.define.amd=modules;var T=kernel["orig.paths"]=createMap(),E=kernel["orig.map"]=createMap(),A=kernel.packages=[],O=kernel["orig.args"]=createMap();avalon.mix(plugins,{paths:function(e){avalon.mix(T,e),kernel.paths=d(T)},map:function(e){avalon.mix(E,e);var t=d(E,1,1);avalon.each(t,function(e,t){t.val=d(t.val)}),kernel.map=t},packages:function(e){e=e.concat(A);for(var t,r=createMap(),n=[],a=0;t=e[a++];){t="string"==typeof t?{name:t}:t;var o=t.name;if(!r[o]){var i=y(t.location||o,t.main||"main");i=i.replace($,""),n.push(t),r[o]=t.location=i,t.reg=f(o)}}kernel.packages=n.sort()},urlArgs:function(e){"string"==typeof e&&(e={"*":e}),avalon.mix(O,e),kernel.urlArgs=d(O,1)},baseUrl:function(e){if(!l(e)){var t=head.getElementsByTagName("base")[0];t&&head.removeChild(t);var r=DOC.createElement("a");r.href=e,e=r.href,t&&head.insertBefore(t,head.firstChild)}e.length>3&&(kernel.baseUrl=e)},shim:function(e){for(var t in e){var r=e[t];Array.isArray(r)&&(r=e[t]={deps:r}),r.exportsFn||!r.exports&&!r.init||(r.exportsFn=v(r))}kernel.shim=e}});var M=innerRequire.plugins={ready:{load:noop},js:{load:function(e,t,r){var n=t.url,a=t.urlNoQuery,o=kernel.shim[e.replace($,"")];o?innerRequire(o.deps||[],function(){var e=avalon.slice(arguments);i(n,a,function(){r(o.exportsFn?o.exportsFn.apply(0,e):void 0)})}):i(n,a)}},css:{load:function(e,t,r){var n=t.url;head.insertAdjacentHTML("afterBegin",'<link rel="stylesheet" href="'+n+'">'),log("debug: 已成功加载 "+n),r()}},text:{load:function(e,t,r){var n=t.url,a=getXHR();a.onload=function(){var e=a.status;e>399&&600>e?avalon.error(n+" 对应资源不存在或没有开启 CORS"):(log("debug: 已成功加载 "+n),r(a.responseText))},a.open("GET",n,!0),"withCredentials"in a&&(a.withCredentials=!0),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.send(),log("debug: 正准备加载 "+n)}}};innerRequire.checkDeps=o;var H=/(\?[^#]*)$/,N=/^callback\d+$/,D=/\/\w+\/\.\./,S=DOC.scripts[DOC.scripts.length-1],R=S.getAttribute("data-main");if(R){plugins.baseUrl(R);var L=kernel.baseUrl;kernel.baseUrl=L.slice(0,L.lastIndexOf("/")+1),i(L.replace($,"")+".js")}else{var j=s(S.src);kernel.baseUrl=j.slice(0,j.lastIndexOf("/")+1)}};var readyList=[],isReady,fireReady=function(e){for(isReady=!0,innerRequire&&(modules["domReady!"].state=4,innerRequire.checkDeps());e=readyList.shift();)e(avalon)};"complete"===DOC.readyState?setTimeout(fireReady):DOC.addEventListener("DOMContentLoaded",fireReady),window.addEventListener("load",fireReady),avalon.ready=function(e){isReady?e(avalon):readyList.push(e)},avalon.config({loader:!0}),avalon.ready(function(){avalon.scan(DOC.body)}),"function"==typeof define&&define.amd&&define("avalon",[],function(){return avalon});var _avalon=window.avalon;return avalon.noConflict=function(e){return e&&window.avalon===avalon&&(window.avalon=_avalon),avalon},void 0===noGlobal&&(window.avalon=avalon),window._injectTer=function(code){return eval(code)},avalon});