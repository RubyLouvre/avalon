!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("Avalon requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(window,noGlobal){function log(){avalon.config.debug&&console.log.apply(console,arguments)}function createMap(){return Object.create(null)}function noop(){}function oneObject(e,t){"string"==typeof e&&(e=e.match(rword)||[]);for(var n={},r=void 0!==t?t:1,a=0,o=e.length;o>a;a++)n[e[a]]=r;return n}function IE(){if(window.VBArray){var e=document.documentMode;return e?e:window.XMLHttpRequest?7:6}return 0}function _number(e,t){return e=Math.floor(e)||0,0>e?Math.max(t+e,0):Math.min(e,t)}function isArrayLike(e){if(e&&"object"==typeof e){var t=e.length,n=serialize.call(e);if(/(Array|List|Collection|Map|Arguments)\]$/.test(n))return!0;if("[object Object]"===n&&t===t>>>0)return!0}return!1}function enumerateNode(e,t){if(e&&e.childNodes)for(var n,r=e.childNodes,a=0;n=r[a++];)if(n.tagName){var o=DOC.createElementNS(svgns,n.tagName.toLowerCase());ap.forEach.call(n.attributes,function(e){o.setAttribute(e.name,e.value)}),enumerateNode(n,o),t.appendChild(o)}}function kernel(e){for(var t in e)if(ohasOwn.call(e,t)){var n=e[t];"function"==typeof kernel.plugins[t]?kernel.plugins[t](n):"object"==typeof kernel[t]?avalon.mix(kernel[t],n):kernel[t]=n}return this}function escapeRegExp(e){return(e+"").replace(rregexp,"\\$&")}function isObservable(e,t,n){if(isFunction(t)||t&&t.nodeType)return!1;if(-1!==n.indexOf(e))return!1;if(-1!==$$skipArray.indexOf(e))return!1;var r=n.$special;return e&&"$"===e.charAt(0)&&!r[e]?!1:!0}function getNewValue(e,t,n,r){switch(e.type){case 0:var a=e.get,o=e.set;if(isFunction(o)){var i=r.$events,s=i[t];i[t]=[],o.call(r,n),i[t]=s}return a.call(r);case 1:return n;case 2:if(n!==r.$model[t]){var l=e.svmodel=objectFactory(r,t,n,e.valueType);n=l.$model;var c=midway[l.$id];c&&c()}return n}}function modelFactory(e,t,n){if(Array.isArray(e)){var r=e.concat();e.length=0;var a=Collection(e);return a.pushArray(r),a}if(!e||e.nodeType>0||e.$id&&e.$events)return e;Array.isArray(e.$skipArray)||(e.$skipArray=[]),e.$skipArray.$special=t||createMap();var o={};n=n||{};var i=createMap(),s=createMap(),l=[];for(var c in e)!function(t,r){if(n[t]=r,isObservable(t,r,e.$skipArray)){i[t]=[];var a=avalon.type(r),c=function(e){var t=c._name,n=this,r=n.$model,a=r[t],o=n.$events;return arguments.length?void(stopRepeatAssign||(1===c.type||(e=getNewValue(c,t,e,n),c.type))&&(isEqual(a,e)||(r[t]=e,notifySubscribers(o[t]),safeFire(n,t,e,a)))):0===c.type?(e=c.get.call(n),a!==e&&(r[t]=e,safeFire(n,t,e,a)),e):(collectSubscribers(o[t]),c.svmodel||a)};"object"===a&&isFunction(r.get)&&Object.keys(r).length<=2?(c.set=r.set,c.get=r.get,c.type=0,l.push(function(){var e={evaluator:function(){e.type=Math.random(),e.element=null,n[t]=c.get.call(o)},element:head,type:Math.random(),handler:noop,args:[]};Registry[expose]=e,c.call(o),delete Registry[expose]})):rcomplexType.test(a)?(c.type=2,c.valueType=a,l.push(function(){var e=modelFactory(r,0,n[t]);c.svmodel=e,e.$events[subscribers]=i[t]})):c.type=1,c._name=t,s[t]=c}}(c,e[c]);$$skipArray.forEach(function(t){delete e[t],delete n[t]}),o=Object.defineProperties(o,descriptorFactory(s),e);for(var u in e)s[u]||(o[u]=e[u]);o.$id=generateID(),o.$model=n,o.$events=i;for(c in EventBus)o[c]=EventBus[c];return Object.defineProperty(o,"hasOwnProperty",{value:function(e){return e in this.$model},writable:!1,enumerable:!1,configurable:!0}),l.forEach(function(e){e()}),o}function safeFire(e,t,n,r){e.$events&&EventBus.$fire.call(e,t,n,r)}function objectFactory(e,t,n,r){var a=e[t];if("array"===r)return Array.isArray(n)&&a!==n?(a._.$unwatch(),a.clear(),a._.$watch(),a.pushArray(n.concat()),a):a;var o=e.$events[t],i=modelFactory(n);return i.$events[subscribers]=o,midway[i.$id]=function(e){for(;e=o.shift();)!function(e){avalon.nextTick(function(){var t=e.type;t&&bindingHandlers[t]&&(e.rollback&&e.rollback(),bindingHandlers[t](e,e.vmodels))})}(e);delete midway[i.$id]},i}function Collection(e){var t=[];t.$id=generateID(),t.$model=e,t.$events={},t.$events[subscribers]=[],t._=modelFactory({length:e.length}),t._.$watch("length",function(e,n){t.$fire("length",e,n)});for(var n in EventBus)t[n]=EventBus[n];return t.$map={el:1},t.$proxy=[],avalon.mix(t,CollectionPrototype),t}function mutateArray(e,t,n,r,a,o,i){for(var s=this.length,l=2;--l;){switch(e){case"add":for(var c=t+n,u=this.$model.slice(t,c).map(function(e){return rcomplexType.test(avalon.type(e))?e.$id?e:modelFactory(e,0,e):e}),d=t;c>d;d++){var p=eachProxyAgent(d,this);this.$proxy.splice(d,0,p)}_splice.apply(this,[t,0].concat(u)),this._fire("add",t,n);break;case"del":var f=this._splice(t,n),v=this.$proxy.splice(t,n);recycleProxies(v,"each"),this._fire("del",t,n)}a&&(e=a,t=o,n=i,l=2,a=0)}return resetIndex(this.$proxy,r),this.length!==s&&(this._.length=this.length),f}function resetIndex(e,t){for(var n,r=e.length-1;n=e[t];t++)n.$index=t,n.$first=0===t,n.$last=t===r}function sortByIndex(e,t){for(var n={},r=0,a=t.length;a>r;r++){n[r]=e[r];var o=t[r];o in n?(e[r]=n[o],delete n[o]):e[r]=e[o]}}function collectSubscribers(e){var t=Registry[expose];e&&t&&avalon.Array.ensure(e,t)&&t.element&&addSubscribers(t,e)}function addSubscribers(e,t){e.$uuid=e.$uuid||generateID(),t.$uuid=t.$uuid||generateID();var n={data:e,list:t,$$uuid:e.$uuid+t.$uuid};$$subscribers[n.$$uuid]||($$subscribers[n.$$uuid]=1,$$subscribers.push(n))}function disposeData(e){e.element=null,e.rollback&&e.rollback();for(var t in e)e[t]=null}function isRemove(e){try{if(!e.parentNode)return!0}catch(t){return!0}return e.msRetain?0:1===e.nodeType?"number"==typeof e.sourceIndex?0===e.sourceIndex:!root.contains(e):!avalon.contains(root,e)}function removeSubscribers(){for(var e,t=$$subscribers.length,n=t,r=0,a=[],o={},i={};e=$$subscribers[--t];){var s=e.data,l=s.type;o[l]?o[l]++:(o[l]=1,a.push(l))}var c=!1;if(a.forEach(function(e){oldInfo[e]!==o[e]&&(i[e]=1,c=!0)}),t=n,c)for(;e=$$subscribers[--t];)s=e.data,void 0!==s.element&&i[s.type]&&isRemove(s.element)&&(r++,$$subscribers.splice(t,1),delete $$subscribers[e.$$uuid],avalon.Array.remove(e.list,s),disposeData(s),e.data=e.list=null);oldInfo=o,beginTime=new Date}function notifySubscribers(e){if(e&&e.length){new Date-beginTime>444&&"object"==typeof e[0]&&removeSubscribers();for(var t,n=aslice.call(arguments,1),r=e.length;t=e[--r];){var a=t.element;if(a&&a.parentNode)if(t.$repeat)t.handler.apply(t,n);else if("on"!==t.type){var o=t.evaluator||noop;t.handler(o.apply(0,t.args||[]),a,t)}}}}function checkScan(e,t,n){var r=setTimeout(function(){var a=e.innerHTML;clearTimeout(r),a===n?t():checkScan(e,t,a)})}function createSignalTower(e,t){var n=e.getAttribute("avalonctrl")||t.$id;e.setAttribute("avalonctrl",n),t.$events.expr=e.tagName+'[avalonctrl="'+n+'"]'}function executeBindings(e,t){for(var n,r=0;n=e[r++];)n.vmodels=t,bindingHandlers[n.type](n,t),n.evaluator&&n.element&&1===n.element.nodeType&&n.element.removeAttribute(n.name);e.length=0}function bindingSorter(e,t){return e.priority-t.priority}function scanAttr(e,t){for(var n,r,a=e.hasAttributes()?avalon.slice(e.attributes):[],o=[],i=createMap(),s=0;r=a[s++];)if(r.specified&&(n=r.name.match(rmsAttr))){var l=n[1],c=n[2]||"",u=r.value,d=r.name;if(i[d]=u,events[l]?(c=l,l="on"):obsoleteAttrs[l]&&(log("warning!请改用ms-attr-"+l+"代替ms-"+l+"！"),"enabled"===l&&(log("warning!ms-enabled或ms-attr-enabled已经被废弃"),l="disabled",u="!("+u+")"),c=l,l="attr",e.removeAttribute(d),d="ms-attr-"+c,e.setAttribute(d,u),n=[d],i[d]=u),"function"==typeof bindingHandlers[l]){var p={type:l,param:c,element:e,name:n[0],value:u,priority:l in priorityMap?priorityMap[l]:10*l.charCodeAt(0)+(Number(c)||0)};if("html"===l||"text"===l){var f=getToken(u);avalon.mix(p,f),p.filters=p.filters.replace(rhasHtml,function(){return p.type="html",p.group=1,""})}"ms-if-loop"===d&&(p.priority+=100),t.length&&(o.push(p),"widget"===l&&(e.msData=e.msData||i))}}var v=e.type;v&&i["ms-duplex"]&&(i["ms-attr-checked"]&&/radio|checkbox/.test(v)&&log("warning!"+v+"控件不能同时定义ms-attr-checked与ms-duplex"),i["ms-attr-value"]&&/text|password/.test(v)&&log("warning!"+v+"控件不能同时定义ms-attr-value与ms-duplex")),o.sort(bindingSorter);var h=!0;for(s=0;p=o[s];s++){if(l=p.type,rnoscanAttrBinding.test(l))return executeBindings(o.slice(0,s+1),t);h&&(h=!rnoscanNodeBinding.test(l))}executeBindings(o,t),h&&!stopScan[e.tagName]&&rbind.test(e.innerHTML+e.textContent)&&(mergeTextNodes&&mergeTextNodes(e),scanNodeList(e,t))}function scanNodeList(e,t){for(var n=e.firstChild;n;){var r=n.nextSibling;scanNode(n,n.nodeType,t),n=r}}function scanNodeArray(e,t){for(var n,r=0;n=e[r++];)scanNode(n,n.nodeType,t)}function scanNode(e,t,n){1===t?(scanTag(e,n),e.msCallback&&(e.msCallback(),e.msCallback=void 0)):3===t&&rexpr.test(e.data)?scanText(e,n):kernel.commentInterpolate&&8===t&&!rexpr.test(e.nodeValue)&&scanText(e,n)}function scanTag(e,t,n){var r=e.getAttribute("ms-skip"),a=e.getAttributeNode("ms-important"),o=e.getAttributeNode("ms-controller");if("string"!=typeof r){if(n=a||o){var i=avalon.vmodels[n.value];if(!i)return;t=n===a?[i]:[i].concat(t),e.removeAttribute(n.name),e.classList.remove(n.name),createSignalTower(e,i)}scanAttr(e,t)}}function getToken(e){if(e.indexOf("|")>0){var t=e.replace(rstringLiteral,function(e){return Array(e.length+1).join("1")}),n=t.replace(r11a,"ᄢ㍄").indexOf("|");if(n>-1)return{filters:e.slice(n),value:e.slice(0,n),expr:!0}}return{value:e,filters:"",expr:!0}}function scanExpr(e){for(var t,n,r=[],a=0;;){if(n=e.indexOf(openTag,a),-1===n)break;if(t=e.slice(a,n),t&&r.push({value:t,filters:"",expr:!1}),a=n+openTag.length,n=e.indexOf(closeTag,a),-1===n)break;t=e.slice(a,n),t&&r.push(getToken(t)),a=n+closeTag.length}return t=e.slice(a),t&&r.push({value:t,expr:!1,filters:""}),r}function scanText(e,t){var n=[];if(8===e.nodeType)var r=getToken(e.nodeValue),a=[r];else a=scanExpr(e.data);if(a.length){for(var o=0;r=a[o++];){var i=DOC.createTextNode(r.value);r.expr&&(r.type="text",r.element=i,r.filters=r.filters.replace(rhasHtml,function(){return r.type="html",r.group=1,""}),n.push(r)),hyperspace.appendChild(i)}e.parentNode.replaceChild(hyperspace,e),n.length&&executeBindings(n,t)}}function hyphen(e){return e.replace(/([a-z\d])([A-Z]+)/g,"$1-$2").toLowerCase()}function camelize(e){return e.indexOf("-")<0&&e.indexOf("_")<0?e:e.replace(/[-_][^-_]/g,function(e){return e.charAt(1).toUpperCase()})}function parseData(e){try{if("object"==typeof e)return e;e="true"===e?!0:"false"===e?!1:"null"===e?null:+e+""===e?+e:rbrace.test(e)?JSON.parse(e):e}catch(t){}return e}function getWindow(e){return e.window&&e.document?e:9===e.nodeType?e.defaultView:!1}function showHidden(e,t){if(e.offsetWidth<=0){var n=getComputedStyle(e,null);if(rdisplayswap.test(n.display)){var r={node:e};for(var a in cssShow)r[a]=n[a],e.style[a]=cssShow[a];t.push(r)}var o=e.parentNode;o&&1===o.nodeType&&showHidden(o,t)}}function getValType(e){var t=e.tagName.toLowerCase();return"input"===t&&/checkbox|radio/.test(e.type)?"checked":t}function addAssign(e,t,n,r){for(var a,o=[],i=" = "+n+".",s=/\$proxy\$each/.test(t.$id),l=e.length;a=e[--l];){var c=s&&t.$map[a]?"el":a;t.hasOwnProperty(c)&&(o.push(a+i+c),r.vars.push(a),"duplex"===r.type&&(e.get=n+"."+c),e.splice(l,1))}return o}function uniqSet(e){for(var t=[],n={},r=0;r<e.length;r++){var a=e[r],o=a&&"string"==typeof a.$id?a.$id:a;n[o]||(n[o]=t.push(a))}return t}function parseFilter(e,t){return t=t.replace(rthimRightParentheses,"").replace(rthimOtherParentheses,function(){return"],|"}).replace(rquoteFilterName,function(e,t){return"["+quote(t)}).replace(rpatchBracket,function(){return'"],["'}).replace(rthimLeftParentheses,function(){return'",'})+"]","return avalon.filters.$filter("+e+", "+t+")"}function parseExpr(e,t,n){var r=n.type,a=n.filters||"",o=t.map(function(e){return String(e.$id).replace(rproxy,"$1")})+e+r+a,i=getVariables(e).concat(),s=[],l=[],c=[],u="";t=uniqSet(t),n.vars=[];for(var d=0,p=t.length;p>d;d++)if(i.length){var f="vm"+expose+"_"+d;l.push(f),c.push(t[d]),s.push.apply(s,addAssign(i,t[d],f,n))}if(s.length||"duplex"!==r){"duplex"!==r&&(e.indexOf("||")>-1||e.indexOf("&&")>-1)&&n.vars.forEach(function(t){var n=new RegExp("\\b"+t+"(?:\\.\\w+|\\[\\w+\\])+","ig");e=e.replace(n,function(n){var r=n.charAt(t.length),a=IEVersion?e.slice(arguments[1]+n.length):RegExp.rightContext,o=/^\s*\(/.test(a);if("."===r||"["===r||o){var i="var"+String(Math.random()).replace(/^0\./,"");if(o){var l=n.split(".");if(l.length>2){var c=l.pop();return s.push(i+" = "+l.join(".")),i+"."+c}return n}return s.push(i+" = "+n),i}return n})}),n.args=c;var v=cacheExprs.get(o);if(v)return void(n.evaluator=v);if(u=s.join(", "),u&&(u="var "+u),/\S/.test(a)){if(!/text|html/.test(n.type))throw Error("ms-"+n.type+"不支持过滤器");e="\nvar ret"+expose+" = "+e+";\r\n",e+=parseFilter("ret"+expose,a)}else{if("duplex"===r){var h="'use strict';\nreturn function(vvv){\n	"+u+";\n	if(!arguments.length){\n		return "+e+"\n	}\n	"+(rduplex.test(e)?e:i.get)+"= vvv;\n} ";try{v=Function.apply(noop,l.concat(h)),n.evaluator=cacheExprs.put(o,v)}catch(m){log("debug: parse error,"+m.message)}return}if("on"===r){-1===e.indexOf("(")?e+=".call(this, $event)":e=e.replace("(",".call(this,"),l.push("$event"),e="\nreturn "+e+";";var g=e.lastIndexOf("\nreturn"),y=e.slice(0,g),b=e.slice(g);e=y+"\n"+b}else e="\nreturn "+e+";"}try{v=Function.apply(noop,l.concat("'use strict';\n"+u+e)),n.evaluator=cacheExprs.put(o,v)}catch(m){log("debug: parse error,"+m.message)}finally{i=s=l=null}}}function parseExprProxy(e,t,n,r,a){Array.isArray(r)&&(e=r.map(function(e){return e.expr?"("+e.value+")":quote(e.value)}).join(" + ")),parseExpr(e,t,n),n.evaluator&&!a&&(n.handler=bindingExecutors[n.handlerName||n.type],avalon.injectBinding(n))}function getTemplateNodes(e,t,n){var r=e.templateCache&&e.templateCache[t];if(r){for(var a,o=DOC.createDocumentFragment();a=r.firstChild;)o.appendChild(a);return o}return avalon.parseHTML(n)}function fixNull(e){return null==e?"":e}function pipe(e,t,n){return t.param.replace(/\w+/g,function(r){var a=avalon.duplexHooks[r];a&&"function"==typeof a[n]&&(e=a[n](e,t))}),e}function ticker(){for(var e=ribbon.length-1;e>=0;e--){var t=ribbon[e];t()===!1&&ribbon.splice(e,1)}ribbon.length||clearInterval(TimerID)}function shimController(e,t,n,r){var a=e.template.cloneNode(!0),o=avalon.slice(a.childNodes);e.$with||a.insertBefore(e.clone.cloneNode(!1),a.firstChild),t.appendChild(a);var i=[n].concat(e.vmodels),s={nodes:o,vmodels:i};r.push(s)}function getComments(e){for(var t=e.element,n=t.nodeValue.replace(":end",""),r=t.previousSibling,a=[];r;)r.nodeValue===n&&a.unshift(r),r=r.previousSibling;return a}function sweepNodes(e,t,n){for(;;){var r=t.previousSibling;if(!r)break;if(r.parentNode.removeChild(r),n&&n.call(r),r===e)break}}function eachProxyFactory(){var e={$index:0,$first:!1,$last:!1,$map:{},$host:[],$outer:{},$remove:avalon.noop,el:{get:function(){var e=this.$events,t=e.$index;e.$index=e.el;try{return this.$host[this.$index]}finally{e.$index=t}},set:function(e){this.$host.set(this.$index,e)}}},t={$last:1,$first:1,$index:1},n=modelFactory(e,t);return n.$id=generateID("$proxy$each"),n}function eachProxyAgent(e,t){var n=eachProxyPool.shift();n||(n=eachProxyFactory());var r=t.length-1;return n.$index=e,n.$first=0===e,n.$last=e===r,n.$map=t.$map,n.$host=t,n.$remove=function(){return t.removeAt(n.$index)},n}function withProxyFactory(){var e=modelFactory({$key:"",$outer:{},$host:{},$val:{get:function(){return this.$host[this.$key]},set:function(e){this.$host[this.$key]=e}}},{$val:1});return e.$id=generateID("$proxy$with"),e}function withProxyAgent(e,t){var n=withProxyPool.pop();n||(n=withProxyFactory());var r=t.$repeat;return n.$key=e,n.$host=r,n.$outer=t.$outer,r.$events?n.$events.$val=r.$events[e]:n.$events={},n}function recycleProxies(e,t){var n="each"===t?eachProxyPool:withProxyPool;avalon.each(e,function(e,t){if(t.$events){for(var r in t.$events)Array.isArray(t.$events[r])&&(t.$events[r].forEach(function(e){"object"==typeof e&&disposeData(e)}),t.$events[r].length=0);t.$host=t.$outer={},n.unshift(t)>kernel.maxRepeatSize&&n.pop()}}),"each"===t&&(e.length=0)}function parseDisplay(e,t){var n="_"+e;if(!parseDisplay[n]){var r=DOC.createElement(e);root.appendChild(r),t=W3C?getComputedStyle(r,null).display:r.currentStyle.display,root.removeChild(r),parseDisplay[n]=t}return parseDisplay[n]}function numberFormat(e,t,n,r){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var a=isFinite(+e)?+e:0,o=isFinite(+t)?Math.abs(t):3,i=r||",",s=n||".",l="",c=function(e,t){var n=Math.pow(10,t);return""+(Math.round(e*n)/n).toFixed(t)};return l=(o?c(a,o):""+Math.round(a)).split("."),l[0].length>3&&(l[0]=l[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,i)),(l[1]||"").length<o&&(l[1]=l[1]||"",l[1]+=new Array(o-l[1].length+1).join("0")),l.join(s)}var expose=Date.now(),DOC=window.document,head=DOC.head;head.insertAdjacentHTML("afterBegin",'<avalon ms-skip class="avalonHide"><style id="avalonStyle">.avalonHide{ display: none!important }</style></avalon>');var ifGroup=head.firstChild,subscribers="$"+expose,otherRequire=window.require,otherDefine=window.define,innerRequire,stopRepeatAssign=!1,rword=/[^, ]+/g,rcomplexType=/^(?:object|array)$/,rsvg=/^\[object SVG\w*Element\]$/,rwindow=/^\[object (?:Window|DOMWindow|global)\]$/,oproto=Object.prototype,ohasOwn=oproto.hasOwnProperty,serialize=oproto.toString,ap=Array.prototype,aslice=ap.slice,Registry={},W3C=window.dispatchEvent,root=DOC.documentElement,hyperspace=DOC.createDocumentFragment(),cinerator=DOC.createElement("div"),class2type={};"Boolean Number String Function Array Date RegExp Object Error".replace(rword,function(e){class2type["[object "+e+"]"]=e.toLowerCase()});var generateID=function(e){return e=e||"avalon",String(Math.random()+Math.random()).replace(/\d\.\d{4}/,e)},IEVersion=IE();avalon=function(e){return new avalon.init(e)},avalon.nextTick=new function(){function e(){for(var e=a.length,t=0;e>t;t++)a[t]();a=a.slice(e)}var t=window.setImmediate,n=window.MutationObserver,r=W3C&&window.postMessage;if(t)return t.bind(window);var a=[];if(n){var o=document.createTextNode("avalon");return new n(e).observe(o,{characterData:!0}),function(e){a.push(e),o.data=Math.random()}}return r?(window.addEventListener("message",function(t){var n=t.source;n!==window&&null!==n||"process-tick"!==t.data||(t.stopPropagation(),e())}),function(e){a.push(e),window.postMessage("process-tick","*")}):function(e){setTimeout(e,0)}},avalon.init=function(e){this[0]=this.element=e},avalon.fn=avalon.prototype=avalon.init.prototype,avalon.type=function(e){return null==e?String(e):"object"==typeof e||"function"==typeof e?class2type[serialize.call(e)]||"object":typeof e};var isFunction=function(e){return"[object Function]"===serialize.call(e)};avalon.isFunction=isFunction,avalon.isWindow=function(e){return rwindow.test(serialize.call(e))},avalon.isPlainObject=function(e){return"[object Object]"===serialize.call(e)&&Object.getPrototypeOf(e)===oproto},avalon.mix=avalon.fn.mix=function(){var e,t,n,r,a,o,i=arguments[0]||{},s=1,l=arguments.length,c=!1;for("boolean"==typeof i&&(c=i,i=arguments[1]||{},s++),"object"==typeof i||isFunction(i)||(i={}),s===l&&(i=this,s--);l>s;s++)if(null!=(e=arguments[s]))for(t in e)n=i[t],r=e[t],i!==r&&(c&&r&&(avalon.isPlainObject(r)||(a=Array.isArray(r)))?(a?(a=!1,o=n&&Array.isArray(n)?n:[]):o=n&&avalon.isPlainObject(n)?n:{},i[t]=avalon.mix(c,o,r)):void 0!==r&&(i[t]=r));return i},avalon.mix({rword:rword,subscribers:subscribers,version:1.43,ui:{},log:log,slice:function(e,t,n){return aslice.call(e,t,n)},noop:noop,error:function(e,t){throw new(t||Error)(e)},oneObject:oneObject,range:function(e,t,n){n||(n=1),null==t&&(t=e||0,e=0);for(var r=-1,a=Math.max(0,Math.ceil((t-e)/n)),o=new Array(a);++r<a;)o[r]=e,e+=n;return o},eventHooks:{},bind:function(e,t,n,r){var a=avalon.eventHooks,o=a[t];return"object"==typeof o&&(t=o.type,o.deel&&(n=o.deel(e,t,n,r))),n.unbind||e.addEventListener(t,n,!!r),n},unbind:function(e,t,n,r){var a=avalon.eventHooks,o=a[t],i=n||noop;"object"==typeof o&&(t=o.type,o.deel&&(n=o.deel(e,t,n,!1))),e.removeEventListener(t,i,!!r)},css:function(e,t,n){e instanceof avalon&&(e=e[0]);var r,a=/[_-]/.test(t)?camelize(t):t;if(t=avalon.cssName(a)||a,void 0===n||"boolean"==typeof n){r=cssHooks[a+":get"]||cssHooks["@:get"],"background"===t&&(t="backgroundColor");var o=r(e,t);return n===!0?parseFloat(o)||0:o}if(""===n)e.style[t]="";else{if(null==n||n!==n)return;isFinite(n)&&!avalon.cssNumber[a]&&(n+="px"),r=cssHooks[a+":set"]||cssHooks["@:set"],r(e,t,n)}},each:function(e,t){if(e){var n=0;if(isArrayLike(e))for(var r=e.length;r>n&&t(n,e[n])!==!1;n++);else for(n in e)if(e.hasOwnProperty(n)&&t(n,e[n])===!1)break}},getWidgetData:function(e,t){var n=avalon(e).data(),r={};for(var a in n)0===a.indexOf(t)&&(r[a.replace(t,"").replace(/\w/,function(e){return e.toLowerCase()})]=n[a]);return r},Array:{ensure:function(e,t){return-1===e.indexOf(t)?e.push(t):void 0},removeAt:function(e,t){return!!e.splice(t,1).length},remove:function(e,t){var n=e.indexOf(t);return~n?avalon.Array.removeAt(e,n):!1}}});var bindingHandlers=avalon.bindingHandlers={},bindingExecutors=avalon.bindingExecutors={},Cache=new function(){function e(e){this.size=0,this.limit=e,this.head=this.tail=void 0,this._keymap={}}var t=e.prototype;return t.put=function(e,t){var n={key:e,value:t};return this._keymap[e]=n,this.tail?(this.tail.newer=n,n.older=this.tail):this.head=n,this.tail=n,this.size===this.limit?this.shift():this.size++,t},t.shift=function(){var e=this.head;e&&(this.head=this.head.newer,this.head.older=e.newer=e.older=this._keymap[e.key]=void 0)},t.get=function(e){var t=this._keymap[e];if(void 0!==t)return t===this.tail?t.value:(t.newer&&(t===this.head&&(this.head=t.newer),t.newer.older=t.older),t.older&&(t.older.newer=t.newer),t.newer=void 0,t.older=this.tail,this.tail&&(this.tail.newer=t),this.tail=t,t.value)},e};if(DOC.contains||(Node.prototype.contains=function(e){return!!(16&this.compareDocumentPosition(e))}),avalon.contains=function(e,t){try{for(;t=t.parentNode;)if(t===e)return!0;return!1}catch(n){return!1}},window.SVGElement){var svgns="http://www.w3.org/2000/svg",svg=DOC.createElementNS(svgns,"svg");svg.innerHTML='<circle cx="50" cy="50" r="40" fill="red" />',rsvg.test(svg.firstChild)||Object.defineProperties(SVGElement.prototype,{outerHTML:{enumerable:!0,configurable:!0,get:function(){return(new XMLSerializer).serializeToString(this)},set:function(e){var t=this.tagName.toLowerCase(),n=this.parentNode,r=avalon.parseHTML(e);if("svg"===t)n.insertBefore(r,this);else{var a=DOC.createDocumentFragment();enumerateNode(r,a),n.insertBefore(a,this)}n.removeChild(this)}},innerHTML:{enumerable:!0,configurable:!0,get:function(){var e=this.outerHTML,t=new RegExp("<"+this.nodeName+'\\b(?:(["\'])[^"]*?(\\1)|[^>])*>',"i"),n=new RegExp("</"+this.nodeName+">$","i");return e.replace(t,"").replace(n,"")},set:function(e){if(avalon.clearHTML){avalon.clearHTML(this);var t=avalon.parseHTML(e);enumerateNode(t,this)}}}})}var eventHooks=avalon.eventHooks;"onmouseenter"in root||avalon.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){eventHooks[e]={type:t,deel:function(t,n,r){return function(n){var a=n.relatedTarget;return a&&(a===t||16&t.compareDocumentPosition(a))?void 0:(delete n.type,n.type=e,r.call(t,n))}}}}),avalon.each({AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"},function(e,t){window[e]&&!eventHooks.animationend&&(eventHooks.animationend={type:t})}),void 0===DOC.onmousewheel&&(eventHooks.mousewheel={type:"wheel",deel:function(e,t,n){return function(t){t.wheelDeltaY=t.wheelDelta=t.deltaY>0?-120:120,t.wheelDeltaX=0,Object.defineProperty(t,"type",{value:"mousewheel"}),n.call(e,t)}}});var openTag,closeTag,rexpr,rexprg,rbind,rregexp=/[-.*+?^${}()|[\]\/\\]/g,plugins={loader:function(e){var t=innerRequire&&e;window.require=t?innerRequire:otherRequire,window.define=t?innerRequire.define:otherDefine},interpolate:function(e){if(openTag=e[0],closeTag=e[1],openTag===closeTag)throw new SyntaxError("openTag!==closeTag");if(e+""=="<!--,-->")kernel.commentInterpolate=!0;else{var t=openTag+"test"+closeTag;if(cinerator.innerHTML=t,cinerator.innerHTML!==t&&cinerator.innerHTML.indexOf("&lt;")>-1)throw new SyntaxError("此定界符不合法");cinerator.innerHTML=""}var n=escapeRegExp(openTag),r=escapeRegExp(closeTag);rexpr=new RegExp(n+"(.*?)"+r),rexprg=new RegExp(n+"(.*?)"+r,"g"),rbind=new RegExp(n+".*?"+r+"|\\sms-")}};kernel.debug=!0,kernel.plugins=plugins,kernel.plugins.interpolate(["{{","}}"]),kernel.paths={},kernel.shim={},kernel.maxRepeatSize=100,avalon.config=kernel;var ravalon=/(\w+)\[(avalonctrl)="(\S+)"\]/,findNodes=function(e){return DOC.querySelectorAll(e)},EventBus={$watch:function(e,t){if("function"==typeof t){var n=this.$events[e];n?n.push(t):this.$events[e]=[t]}else this.$events=this.$watch.backup;return this},$unwatch:function(e,t){var n=arguments.length;if(0===n)this.$watch.backup=this.$events,this.$events={};else if(1===n)this.$events[e]=[];else for(var r=this.$events[e]||[],a=r.length;~--a<0;)if(r[a]===t)return r.splice(a,1);return this},$fire:function(e){var t,n,r,a;/^(\w+)!(\S+)$/.test(e)&&(t=RegExp.$1,e=RegExp.$2);var o=this.$events;if(o){var i=aslice.call(arguments,1),s=[e].concat(i);if("all"===t)for(n in avalon.vmodels)r=avalon.vmodels[n],r!==this&&r.$fire.apply(r,s);else if("up"===t||"down"===t){var l=o.expr?findNodes(o.expr):[];if(0===l.length)return;for(n in avalon.vmodels)if(r=avalon.vmodels[n],r!==this&&r.$events.expr){var c=findNodes(r.$events.expr);if(0===c.length)continue;Array.prototype.forEach.call(c,function(e){Array.prototype.forEach.call(l,function(n){var a="down"===t?n.contains(e):e.contains(n);a&&(e._avalon=r)})})}var u=DOC.getElementsByTagName("*"),d=[];for(Array.prototype.forEach.call(u,function(e){e._avalon&&(d.push(e._avalon),e._avalon="",e.removeAttribute("_avalon"))}),"up"===t&&d.reverse(),n=0;(a=d[n++])&&a.$fire.apply(a,s)!==!1;);}else{var p=o[e]||[],f=o.$all||[];for(n=0;a=p[n++];)isFunction(a)&&a.apply(this,i);for(n=0;a=f[n++];)isFunction(a)&&a.apply(this,arguments)}}}},VMODELS=avalon.vmodels=createMap();avalon.define=function(e,t){var n=e.$id||e;if(n||log("warning: vm必须指定$id"),VMODELS[n]&&log("warning: "+n+" 已经存在于avalon.vmodels中"),"object"==typeof e)var r=modelFactory(e);else{var a={$watch:noop};t(a),r=modelFactory(a),stopRepeatAssign=!0,t(r),stopRepeatAssign=!1}return r.$id=n,VMODELS[n]=r};var $$skipArray=String("$id,$watch,$unwatch,$fire,$events,$model,$skipArray").match(rword),midway=createMap(),isEqual=Object.is||function(e,t){return 0===e&&0===t?1/e===1/t:e!==e?t!==t:e===t},descriptorFactory=function(e){var t=createMap();for(var n in e)t[n]={get:e[n],set:e[n],enumerable:!0,configurable:!0};return t},_splice=ap.splice,CollectionPrototype={_splice:_splice,_fire:function(e,t,n){notifySubscribers(this.$events[subscribers],e,t,n)},size:function(){return this._.length},pushArray:function(e){var t=e.length,n=this.length;return t&&(ap.push.apply(this.$model,e),mutateArray.call(this,"add",n,t,Math.max(0,n-1))),t+n},push:function(){var e,t=[],n=arguments.length;for(e=0;n>e;e++)t[e]=arguments[e];return this.pushArray(t)},unshift:function(){var e=arguments.length,t=this.length;return e&&(ap.unshift.apply(this.$model,arguments),mutateArray.call(this,"add",0,e,0)),e+t},shift:function(){if(this.length){var e=this.$model.shift();return mutateArray.call(this,"del",0,1,0),e}},pop:function(){var e=this.length;if(e){var t=this.$model.pop();return mutateArray.call(this,"del",e-1,1,Math.max(0,e-2)),t}},splice:function(e){var t,n=arguments.length,r=[],a=_splice.apply(this.$model,arguments);return a.length&&(r.push("del",e,a.length,0),t=!0),n>2&&(t?r.splice(3,1,0,"add",e,n-2):r.push("add",e,n-2,0),t=!0),t?mutateArray.apply(this,r):[]},contains:function(e){return-1!==this.indexOf(e)},remove:function(e){return this.removeAt(this.indexOf(e))},removeAt:function(e){return e>=0?(this.$model.splice(e,1),mutateArray.call(this,"del",e,1,0)):[]},clear:function(){return recycleProxies(this.$proxy,"each"),this.$model.length=this.$proxy.length=this.length=this._.length=0,this._fire("clear",0),this},removeAll:function(e){if(Array.isArray(e))e.forEach(function(e){this.remove(e)},this);else if("function"==typeof e)for(var t=this.length-1;t>=0;t--){var n=this[t];e(n,t)&&this.removeAt(t)}else this.clear()},ensure:function(e){return this.contains(e)||this.push(e),this},set:function(e,t){if(e>=0){var n=avalon.type(t);t&&t.$model&&(t=t.$model);var r=this[e];if("object"===n)for(var a in t)r.hasOwnProperty(a)&&(r[a]=t[a]);else if("array"===n)r.clear().push.apply(r,t);else if(r!==t){this[e]=t,this.$model[e]=t;var o=this.$proxy[e];o&&notifySubscribers(o.$events.el)}}return this}};"sort,reverse".replace(rword,function(e){CollectionPrototype[e]=function(){var t,n=this.$model,r=n.concat(),a=Math.random(),o=[];ap[e].apply(n,arguments);for(var i=0,s=r.length;s>i;i++){var l=n[i],c=r[i];if(isEqual(l,c))o.push(i);else{var u=r.indexOf(l);o.push(u),r[u]=a,t=!0}}return t&&(sortByIndex(this,o),sortByIndex(this.$proxy,o),this._fire("move",o),resetIndex(this.$proxy,0)),this}});var ronduplex=/^(duplex|on)$/;avalon.injectBinding=function(e){Registry[expose]=e,avalon.openComputedCollect=!0;var t=e.evaluator;if(t)try{var n=ronduplex.test(e.type)?e:t.apply(0,e.args);e.noRefresh||e.handler(n,e.element,e)}catch(r){delete e.evaluator;var a=e.element;if(3===a.nodeType){var o=a.parentNode;kernel.commentInterpolate?o.replaceChild(DOC.createComment(e.value),a):a.data=openTag+e.value+closeTag}}avalon.openComputedCollect=!1,delete Registry[expose]};var $$subscribers=avalon.$$subscribers=[],beginTime=new Date,oldInfo={},tagHooks=new function(){avalon.mix(this,{option:DOC.createElement("select"),thead:DOC.createElement("table"),td:DOC.createElement("tr"),area:DOC.createElement("map"),tr:DOC.createElement("tbody"),col:DOC.createElement("colgroup"),legend:DOC.createElement("fieldset"),_default:DOC.createElement("div"),g:DOC.createElementNS("http://www.w3.org/2000/svg","svg")}),this.optgroup=this.option,this.tbody=this.tfoot=this.colgroup=this.caption=this.thead,this.th=this.td};String("circle,defs,ellipse,image,line,path,polygon,polyline,rect,symbol,text,use").replace(rword,function(e){tagHooks[e]=tagHooks.g});var rtagName=/<([\w:]+)/,rxhtml=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,scriptTypes=oneObject(["","text/javascript","text/ecmascript","application/ecmascript","application/javascript"]),script=DOC.createElement("script"),rhtml=/<|&#?\w+;/;avalon.parseHTML=function(e){var t=hyperspace.cloneNode(!1);if("string"!=typeof e)return t;if(!rhtml.test(e))return t.appendChild(DOC.createTextNode(e)),t;e=e.replace(rxhtml,"<$1></$2>").trim();var n,r=(rtagName.exec(e)||["",""])[1].toLowerCase(),a=tagHooks[r]||tagHooks._default;a.innerHTML=e;var o=a.getElementsByTagName("script");if(o.length)for(var i,s=0;i=o[s++];)if(scriptTypes[i.type]){var l=script.cloneNode(!1);ap.forEach.call(i.attributes,function(e){l.setAttribute(e.name,e.value)}),l.text=i.text,i.parentNode.replaceChild(l,i)}for(;n=a.firstChild;)t.appendChild(n);return t},avalon.innerHTML=function(e,t){var n=this.parseHTML(t);this.clearHTML(e).appendChild(n)},avalon.clearHTML=function(e){for(e.textContent="";e.firstChild;)e.removeChild(e.firstChild);return e},avalon.scan=function(e,t){e=e||root;var n=t?[].concat(t):[];scanTag(e,n)};var stopScan=oneObject("area,base,basefont,br,col,command,embed,hr,img,input,link,meta,param,source,track,wbr,noscript,script,style,textarea".toUpperCase()),getBindingCallback=function(e,t,n){var r=e.getAttribute(t);if(r)for(var a,o=0;a=n[o++];)if(a.hasOwnProperty(r)&&"function"==typeof a[r])return a[r]},mergeTextNodes=IEVersion&&window.MutationObserver?function(e){for(var t,n=e.firstChild;n;){var r=n.nextSibling;3===n.nodeType?t?(t.nodeValue+=n.nodeValue,e.removeChild(n)):t=n:t=null,n=r}}:0,rmsAttr=/ms-(\w+)-?(.*)/,priorityMap={"if":10,repeat:90,data:100,widget:110,each:1400,"with":1500,duplex:2e3,on:3e3},events=oneObject("animationend,blur,change,input,click,dblclick,focus,keydown,keypress,keyup,mousedown,mouseenter,mouseleave,mousemove,mouseout,mouseover,mouseup,scan,scroll,submit"),obsoleteAttrs=oneObject("value,title,alt,checked,selected,disabled,readonly,enabled"),rnoscanAttrBinding=/^if|widget|repeat$/,rnoscanNodeBinding=/^each|with|html|include$/,rhasHtml=/\|\s*html\s*/,r11a=/\|\|/g,rlt=/&lt;/g,rgt=/&gt;/g,rstringLiteral=/(['"])(\\\1|.)+?\1/g;
"add,remove".replace(rword,function(e){avalon.fn[e+"Class"]=function(t){var n=this[0];return t&&"string"==typeof t&&n&&1===n.nodeType&&t.replace(/\S+/g,function(t){n.classList[e](t)}),this}}),avalon.fn.mix({hasClass:function(e){var t=this[0]||{};return 1===t.nodeType&&t.classList.contains(e)},toggleClass:function(e,t){for(var n,r=0,a=String(e).split(/\s+/),o="boolean"==typeof t;n=a[r++];){var i=o?t:!this.hasClass(n);this[i?"addClass":"removeClass"](n)}return this},attr:function(e,t){return 2===arguments.length?(this[0].setAttribute(e,t),this):this[0].getAttribute(e)},data:function(e,t){switch(e="data-"+hyphen(e||""),arguments.length){case 2:return this.attr(e,t),this;case 1:var n=this.attr(e);return parseData(n);case 0:var r={};return ap.forEach.call(this[0].attributes,function(t){t&&(e=t.name,e.indexOf("data-")||(e=camelize(e.slice(5)),r[e]=parseData(t.value)))}),r}},removeData:function(e){return e="data-"+hyphen(e),this[0].removeAttribute(e),this},css:function(e,t){if(avalon.isPlainObject(e))for(var n in e)avalon.css(this,n,e[n]);else var r=avalon.css(this,e,t);return void 0!==r?r:this},position:function(){var e,t,n=this[0],r={top:0,left:0};if(n)return"fixed"===this.css("position")?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),"HTML"!==e[0].tagName&&(r=e.offset()),r.top+=avalon.css(e[0],"borderTopWidth",!0),r.left+=avalon.css(e[0],"borderLeftWidth",!0),r.top-=e.scrollTop(),r.left-=e.scrollLeft()),{top:t.top-r.top-avalon.css(n,"marginTop",!0),left:t.left-r.left-avalon.css(n,"marginLeft",!0)}},offsetParent:function(){for(var e=this[0].offsetParent;e&&"static"===avalon.css(e,"position");)e=e.offsetParent;return avalon(e||root)},bind:function(e,t,n){return this[0]?avalon.bind(this[0],e,t,n):void 0},unbind:function(e,t,n){return this[0]&&avalon.unbind(this[0],e,t,n),this},val:function(e){var t=this[0];if(t&&1===t.nodeType){var n=0===arguments.length,r=n?":get":":set",a=valHooks[getValType(t)+r];if(a)var o=a(t,e);else{if(n)return(t.value||"").replace(/\r/g,"");t.value=e}}return n?o:this}}),root.dataset&&(avalon.fn.data=function(e,t){e=e&&camelize(e);var n=this[0].dataset;switch(arguments.length){case 2:return n[e]=t,this;case 1:return t=n[e],parseData(t);case 0:var r=createMap();for(e in n)r[e]=parseData(n[e]);return r}});var rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/;avalon.parseJSON=JSON.parse,avalon.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){avalon.fn[e]=function(n){var r=this[0]||{},a=getWindow(r),o="scrollTop"===e;return arguments.length?void(a?a.scrollTo(o?a[t]:n,o?n:a[t]):r[e]=n):a?a[t]:r[e]}});var cssHooks=avalon.cssHooks=createMap(),prefixes=["","-webkit-","-moz-","-ms-"],cssMap={"float":"cssFloat"};avalon.cssNumber=oneObject("columnCount,order,fillOpacity,fontWeight,lineHeight,opacity,orphans,widows,zIndex,zoom"),avalon.cssName=function(e,t,n){if(cssMap[e])return cssMap[e];t=t||root.style;for(var r=0,a=prefixes.length;a>r;r++)if(n=camelize(prefixes[r]+e),n in t)return cssMap[e]=n;return null},cssHooks["@:set"]=function(e,t,n){e.style[t]=n},cssHooks["@:get"]=function(e,t){if(!e||!e.style)throw new Error("getComputedStyle要求传入一个节点 "+e);var n,r=getComputedStyle(e);return r&&(n="filter"===t?r.getPropertyValue(t):r[t],""===n&&(n=e.style[t])),n},cssHooks["opacity:get"]=function(e){var t=cssHooks["@:get"](e,"opacity");return""===t?"1":t},"top,left".replace(rword,function(e){cssHooks[e+":get"]=function(t){var n=cssHooks["@:get"](t,e);return/px$/.test(n)?n:avalon(t).position()[e]+"px"}});var cssShow={position:"absolute",visibility:"hidden",display:"block"},rdisplayswap=/^(none|table(?!-c[ea]).+)/;"Width,Height".replace(rword,function(e){var t=e.toLowerCase(),n="client"+e,r="scroll"+e,a="offset"+e;cssHooks[t+":get"]=function(t,n,r){var o=-4;"number"==typeof r&&(o=r),n="Width"===e?["Left","Right"]:["Top","Bottom"];var i=t[a];return 2===o?i+avalon.css(t,"margin"+n[0],!0)+avalon.css(t,"margin"+n[1],!0):(0>o&&(i=i-avalon.css(t,"border"+n[0]+"Width",!0)-avalon.css(t,"border"+n[1]+"Width",!0)),-4===o&&(i=i-avalon.css(t,"padding"+n[0],!0)-avalon.css(t,"padding"+n[1],!0)),i)},cssHooks[t+"&get"]=function(e){var n=[];showHidden(e,n);for(var r,a=cssHooks[t+":get"](e),o=0;r=n[o++];){e=r.node;for(var i in r)"string"==typeof r[i]&&(e.style[i]=r[i])}return a},avalon.fn[t]=function(o){var i=this[0];if(0===arguments.length){if(i.setTimeout)return i["inner"+e];if(9===i.nodeType){var s=i.documentElement;return Math.max(i.body[r],s[r],i.body[a],s[a],s[n])}return cssHooks[t+"&get"](i)}return this.css(t,o)},avalon.fn["inner"+e]=function(){return cssHooks[t+":get"](this[0],void 0,-2)},avalon.fn["outer"+e]=function(e){return cssHooks[t+":get"](this[0],void 0,e===!0?2:0)}}),avalon.fn.offset=function(){var e=this[0];try{var t=e.getBoundingClientRect();if(t.width||t.height||e.getClientRects().length){var n=e.ownerDocument,r=n.documentElement,a=n.defaultView;return{top:t.top+a.pageYOffset-r.clientTop,left:t.left+a.pageXOffset-r.clientLeft}}}catch(o){return{left:0,top:0}}};var valHooks={"select:get":function(e,t){for(var n,r=e.options,a=e.selectedIndex,o="select-one"===e.type||0>a,i=o?null:[],s=o?a+1:r.length,l=0>a?s:o?a:0;s>l;l++)if(n=r[l],(n.selected||l===a)&&!n.disabled){if(t=n.value,o)return t;i.push(t)}return i},"select:set":function(e,t,n){t=[].concat(t);for(var r,a=0;r=e.options[a++];)(r.selected=t.indexOf(r.value)>-1)&&(n=!0);n||(e.selectedIndex=-1)}},quote=JSON.stringify,keywords=["break,case,catch,continue,debugger,default,delete,do,else,false","finally,for,function,if,in,instanceof,new,null,return,switch,this","throw,true,try,typeof,var,void,while,with","abstract,boolean,byte,char,class,const,double,enum,export,extends","final,float,goto,implements,import,int,interface,long,native","package,private,protected,public,short,static,super,synchronized","throws,transient,volatile","arguments,let,yield,undefined"].join(","),rrexpstr=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|[\s\t\n]*\.[\s\t\n]*[$\w\.]+/g,rsplit=/[^\w$]+/g,rkeywords=new RegExp(["\\b"+keywords.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),rnumber=/\b\d[^,]*/g,rcomma=/^,+|,+$/g,cacheVars=new Cache(512),getVariables=function(e){var t=","+e.trim(),n=cacheVars.get(t);if(n)return n;var r=e.replace(rrexpstr,"").replace(rsplit,",").replace(rkeywords,"").replace(rnumber,"").replace(rcomma,"").split(/^$|,+/);return cacheVars.put(t,uniqSet(r))},cacheExprs=new Cache(128),rduplex=/\w\[.*\]|\w\.\w/,rproxy=/(\$proxy\$[a-z]+)\d+$/,rthimRightParentheses=/\)\s*$/,rthimOtherParentheses=/\)\s*\|/g,rquoteFilterName=/\|\s*([$\w]+)/g,rpatchBracket=/"\s*\["/g,rthimLeftParentheses=/"\s*\(/g;avalon.parseExprProxy=parseExprProxy;var bools=["autofocus,autoplay,async,allowTransparency,checked,controls","declare,disabled,defer,defaultChecked,defaultSelected","contentEditable,isMap,loop,multiple,noHref,noResize,noShade","open,readOnly,selected"].join(","),boolMap={};bools.replace(rword,function(e){boolMap[e.toLowerCase()]=e});var propMap={"accept-charset":"acceptCharset","char":"ch",charoff:"chOff","class":"className","for":"htmlFor","http-equiv":"httpEquiv"},anomaly=["accessKey,bgColor,cellPadding,cellSpacing,codeBase,codeType,colSpan","dateTime,defaultValue,frameBorder,longDesc,maxLength,marginWidth,marginHeight","rowSpan,tabIndex,useMap,vSpace,valueType,vAlign"].join(",");anomaly.replace(rword,function(e){propMap[e.toLowerCase()]=e});var rnoscripts=/<noscript.*?>(?:[\s\S]+?)<\/noscript>/gim,rnoscriptText=/<noscript.*?>([\s\S]+?)<\/noscript>/im,getXHR=function(){return new(window.XMLHttpRequest||ActiveXObject)("Microsoft.XMLHTTP")},cacheTmpls=avalon.templateCache={};bindingHandlers.attr=function(e,t){var n=e.value.trim(),r=!0;if(n.indexOf(openTag)>-1&&n.indexOf(closeTag)>2&&(r=!1,rexpr.test(n)&&""===RegExp.rightContext&&""===RegExp.leftContext&&(r=!0,n=RegExp.$1)),"include"===e.type){var a=e.element;e.includeRendered=getBindingCallback(a,"data-include-rendered",t),e.includeLoaded=getBindingCallback(a,"data-include-loaded",t);var o=e.includeReplace=!!avalon(a).data("includeReplace");avalon(a).data("includeCache")&&(e.templateCache={}),e.startInclude=DOC.createComment("ms-include"),e.endInclude=DOC.createComment("ms-include-end"),o?(e.element=e.startInclude,a.parentNode.insertBefore(e.startInclude,a),a.parentNode.insertBefore(e.endInclude,a.nextSibling)):(a.insertBefore(e.startInclude,a.firstChild),a.appendChild(e.endInclude))}e.handlerName="attr",parseExprProxy(n,t,e,r?0:scanExpr(e.value))},bindingExecutors.attr=function(e,t,n){var r=n.type,a=n.param;if("css"===r)avalon(t).css(a,e);else if("attr"===r){var o=e===!1||null===e||void 0===e;!W3C&&propMap[a]&&(a=propMap[a]);var i=boolMap[a];if("boolean"==typeof t[i]&&(t[i]=!!e,e||(o=!0)),o)return t.removeAttribute(a);var s=rsvg.test(t)?!1:DOC.namespaces&&isVML(t)?!0:a in t.cloneNode(!1);s?t[a]=e:t.setAttribute(a,e)}else if("include"===r&&e){var l=n.vmodels,c=n.includeRendered,u=n.includeLoaded,d=n.includeReplace,p=d?t.parentNode:t,f=function(t){if(u){var r=u.apply(p,[t].concat(l));"string"==typeof r&&(t=r)}c&&checkScan(p,function(){c.call(p)},0/0);var a=n.includeLastID;if(n.templateCache&&a&&a!==e){var o=n.templateCache[a];o||(o=n.templateCache[a]=DOC.createElement("div"),ifGroup.appendChild(o))}for(n.includeLastID=e;;){var i=n.startInclude.nextSibling;if(!i||i===n.endInclude)break;p.removeChild(i),o&&o.appendChild(i)}var s=getTemplateNodes(n,e,t),d=avalon.slice(s.childNodes);p.insertBefore(s,n.endInclude),scanNodeArray(d,l)};if("src"===n.param)if("string"==typeof cacheTmpls[e])avalon.nextTick(function(){f(cacheTmpls[e])});else if(Array.isArray(cacheTmpls[e]))cacheTmpls[e].push(f);else{var v=getXHR();v.onreadystatechange=function(){if(4===v.readyState){var t=v.status;if(t>=200&&300>t||304===t||1223===t){for(var n,r=v.responseText,a=0;n=cacheTmpls[e][a++];)n(r);cacheTmpls[e]=r}}},cacheTmpls[e]=[f],v.open("GET",e,!0),"withCredentials"in v&&(v.withCredentials=!0),v.setRequestHeader("X-Requested-With","XMLHttpRequest"),v.send(null)}else{var h=e&&1===e.nodeType?e:DOC.getElementById(e);if(h){if("NOSCRIPT"===h.tagName&&!h.innerHTML&&!h.fixIE78){v=getXHR(),v.open("GET",location,!1),v.send(null);for(var m=DOC.getElementsByTagName("noscript"),g=(v.responseText||"").match(rnoscripts)||[],y=g.length,b=0;y>b;b++){var x=m[b];x&&(x.style.display="none",x.fixIE78=(g[b].match(rnoscriptText)||["","&nbsp;"])[1])}}avalon.nextTick(function(){f(h.fixIE78||h.value||h.innerText||h.innerHTML)})}}}else if(root.hasAttribute||"string"!=typeof e||"src"!==r&&"href"!==r||(e=e.replace(/&amp;/g,"&")),t[r]=e,window.chrome&&"EMBED"===t.tagName){var w=t.parentNode,$=document.createComment("ms-src");w.replaceChild($,t),w.replaceChild(t,$)}},"title,alt,src,value,css,include,href".replace(rword,function(e){bindingHandlers[e]=bindingHandlers.attr}),bindingHandlers["class"]=function(e,t){var n,r=e.param,a=e.value;if(e.handlerName="class",!r||isFinite(r)){e.param="";var o=a.replace(rexprg,function(e){return e.replace(/./g,"0")}),i=o.indexOf(":");if(-1===i)var s=a;else{if(s=a.slice(0,i),n=a.slice(i+1),parseExpr(n,t,e),!e.evaluator)return log("debug: ms-class '"+(n||"").trim()+"' 不存在于VM中"),!1;e._evaluator=e.evaluator,e._args=e.args}var l=rexpr.test(s);l||(e.immobileClass=s),parseExprProxy("",t,e,l?scanExpr(s):0)}else e.immobileClass=e.oldStyle=e.param,parseExprProxy(a,t,e)},bindingExecutors["class"]=function(e,t,n){var r=avalon(t),a=n.type;if("class"===a&&n.oldStyle)r.toggleClass(n.oldStyle,!!e);else switch(n.toggleClass=n._evaluator?!!n._evaluator.apply(t,n._args):!0,n.newClass=n.immobileClass||e,n.oldClass&&n.newClass!==n.oldClass&&r.removeClass(n.oldClass),n.oldClass=n.newClass,a){case"class":r.toggleClass(n.newClass,n.toggleClass);break;case"hover":case"active":if(!n.hasBindEvent){var o="mouseenter",i="mouseleave";if("active"===a){t.tabIndex=t.tabIndex||-1,o="mousedown",i="mouseup";var s=r.bind("mouseleave",function(){n.toggleClass&&r.removeClass(n.newClass)})}var l=r.bind(o,function(){n.toggleClass&&r.addClass(n.newClass)}),c=r.bind(i,function(){n.toggleClass&&r.removeClass(n.newClass)});n.rollback=function(){r.unbind("mouseleave",s),r.unbind(o,l),r.unbind(i,c)},n.hasBindEvent=!0}}},"hover,active".replace(rword,function(e){bindingHandlers[e]=bindingHandlers["class"]}),bindingExecutors.data=function(e,t,n){var r="data-"+n.param;e&&"object"==typeof e?t[r]=e:t.setAttribute(r,String(e))};var duplexBinding=bindingHandlers.duplex=function(e,t){var n,r=e.element;if(parseExprProxy(e.value,t,e,0,1),e.changed=getBindingCallback(r,"data-duplex-changed",t)||noop,e.evaluator&&e.args){var a=[],o=oneObject("string,number,boolean,checked");"radio"===r.type&&""===e.param&&(e.param="checked"),r.msData&&(r.msData["ms-duplex"]=e.value),e.param.replace(/\w+/g,function(t){/^(checkbox|radio)$/.test(r.type)&&/^(radio|checked)$/.test(t)&&("radio"===t&&log("ms-duplex-radio已经更名为ms-duplex-checked"),t="checked",e.isChecked=!0),"bool"===t?(t="boolean",log("ms-duplex-bool已经更名为ms-duplex-boolean")):"text"===t&&(t="string",log("ms-duplex-text已经更名为ms-duplex-string")),o[t]&&(n=!0),avalon.Array.ensure(a,t)}),n||a.push("string"),e.param=a.join("-"),e.bound=function(t,n){r.addEventListener?r.addEventListener(t,n,!1):r.attachEvent("on"+t,n);var a=e.rollback;e.rollback=function(){r.avalonSetter=null,avalon.unbind(r,t,n),a&&a()}};for(var i in avalon.vmodels){var s=avalon.vmodels[i];s.$fire("avalon-ms-duplex-init",e)}var l=e.pipe||(e.pipe=pipe);l(null,e,"init");var c=r.tagName;duplexBinding[c]&&duplexBinding[c](r,e.evaluator.apply(null,e.args),e)}};avalon.duplexHooks={checked:{get:function(e,t){return!t.element.oldValue}},string:{get:function(e){return e},set:fixNull},"boolean":{get:function(e){return"true"===e},set:fixNull},number:{get:function(e,t){var n=parseFloat(e);if(-e===-n)return n;var r=/strong|medium|weak/.exec(t.element.getAttribute("data-duplex-number"))||["medium"];switch(r[0]){case"strong":return 0;case"medium":return""===e?"":0;case"weak":return e}},set:fixNull}};var TimerID,ribbon=[];avalon.tick=function(e){1===ribbon.push(e)&&(TimerID=setInterval(ticker,60))};var watchValueInTimer=noop,rmsinput=/text|password|hidden/;!new function(){function e(e){if(avalon.contains(root,this)){if(t[this.tagName].call(this,e),!rmsinput.test(this.type))return;!this.msFocus&&this.avalonSetter&&this.avalonSetter()}}try{var t={},n=HTMLInputElement.prototype,r=HTMLTextAreaElement.prototype,a=HTMLInputElement.prototype;Object.getOwnPropertyNames(a),t.INPUT=Object.getOwnPropertyDescriptor(n,"value").set,Object.defineProperty(n,"value",{set:e}),t.TEXTAREA=Object.getOwnPropertyDescriptor(r,"value").set,Object.defineProperty(r,"value",{set:e})}catch(o){watchValueInTimer=avalon.tick}},duplexBinding.INPUT=function(e,t,n){function r(e){n.changed.call(this,e,n)}function a(){c=!0}function o(){c=!1}var i=e.type,s=n.bound,l=avalon(e),c=!1,u=function(){if(!c){var a=e.oldValue=e.value,o=n.pipe(a,n,"get");l.data("duplexObserve")!==!1&&(t(o),r.call(e,o),l.data("duplex-focus")&&avalon.nextTick(function(){e.focus()}))}};if(n.handler=function(){var r=n.pipe(t(),n,"set")+"";r!==e.oldValue&&(e.value=r)},n.isChecked||"radio"===i)u=function(){if(l.data("duplexObserve")!==!1){var a=n.pipe(e.value,n,"get");t(a),r.call(e,a)}},n.handler=function(){var r=t(),a=n.isChecked?!!r:r+""===e.value;e.checked=e.oldValue=a},s("click",u);else if("checkbox"===i)u=function(){if(l.data("duplexObserve")!==!1){var a=e.checked?"ensure":"remove",o=t();Array.isArray(o)||(log("ms-duplex应用于checkbox上要对应一个数组"),o=[o]),avalon.Array[a](o,n.pipe(e.value,n,"get")),r.call(e,o)}},n.handler=function(){var r=[].concat(t());e.checked=r.indexOf(n.pipe(e.value,n,"get"))>-1},s("change",u);else{var d=e.getAttribute("data-duplex-event")||"input";e.attributes["data-event"]&&log("data-event指令已经废弃，请改用data-duplex-event"),d.replace(rword,function(e){switch(e){case"input":s("input",u),s("DOMAutoComplete",u),IEVersion||(s("compositionstart",a),s("compositionend",o));break;default:s(e,u)}}),s("focus",function(){e.msFocus=!0}),s("blur",function(){e.msFocus=!1}),rmsinput.test(i)&&watchValueInTimer(function(){if(root.contains(e))e.msFocus||e.oldValue===e.value||u();else if(!e.msRetain)return!1}),e.avalonSetter=u}e.oldValue=e.value,avalon.injectBinding(n),r.call(e,e.value)},duplexBinding.TEXTAREA=duplexBinding.INPUT,duplexBinding.SELECT=function(e,t,n){function r(){if(a.data("duplexObserve")!==!1){var r=a.val();r=Array.isArray(r)?r.map(function(e){return n.pipe(e,n,"get")}):n.pipe(r,n,"get"),r+""!==e.oldValue&&t(r),n.changed.call(e,r,n)}}var a=avalon(e);n.handler=function(){var n=t();n=n&&n.$model||n,Array.isArray(n)?e.multiple||log("ms-duplex在<select multiple=true>上要求对应一个数组"):e.multiple&&log("ms-duplex在<select multiple=false>不能对应一个数组"),n=Array.isArray(n)?n.map(String):n+"",n+""!==e.oldValue&&(a.val(n),e.oldValue=n+"")},n.bound("change",r),e.msCallback=function(){avalon.injectBinding(n),n.changed.call(e,t(),n)}},bindingExecutors.html=function(e,t,n){e=null==e?"":e;var r="group"in n,a=r?t.parentNode:t;if(a){if("string"==typeof e)var o=avalon.parseHTML(e);else if(11===e.nodeType)o=e;else if(1===e.nodeType||e.item){var i=1===e.nodeType?e.childNodes:e.item;for(o=hyperspace.cloneNode(!0);i[0];)o.appendChild(i[0])}if(o.firstChild||o.appendChild(DOC.createComment("ms-html")),i=avalon.slice(o.childNodes),r){var s=n.group,l=1;for(n.group=i.length,n.element=i[0];s>l;){var c=t.nextSibling;c&&(a.removeChild(c),l++)}a.replaceChild(o,t)}else avalon.clearHTML(a).appendChild(o);scanNodeArray(i,n.vmodels)}},bindingHandlers["if"]=bindingHandlers.data=bindingHandlers.text=bindingHandlers.html=function(e,t){parseExprProxy(e.value,t,e)},bindingExecutors["if"]=function(e,t,n){if(e)8===t.nodeType&&(t.parentNode.replaceChild(n.template,t),t=n.element=n.template),t.getAttribute(n.name)&&(t.removeAttribute(n.name),scanAttr(t,n.vmodels)),n.rollback=null;else if(1===t.nodeType){var r=n.element=DOC.createComment("ms-if");t.parentNode.replaceChild(r,t),n.template=t,ifGroup.appendChild(t),n.rollback=function(){t.parentNode===ifGroup&&ifGroup.removeChild(t)}}};var rdash=/\(([^)]*)\)/;bindingHandlers.on=function(e,t){var n=e.value;e.type="on";var r=e.param.replace(/-\d+$/,"");if("function"==typeof bindingHandlers.on[r+"Hook"]&&bindingHandlers.on[r+"Hook"](e),n.indexOf("(")>0&&n.indexOf(")")>-1){var a=(n.match(rdash)||["",""])[1].trim();(""===a||"$event"===a)&&(n=n.replace(rdash,""))}parseExprProxy(n,t,e)},bindingExecutors.on=function(e,t,n){e=function(e){var t=n.evaluator||noop;return t.apply(this,n.args.concat(e))};var r=n.param.replace(/-\d+$/,"");if("scan"===r)e.call(t,{type:r});else if("function"==typeof n.specialBind)n.specialBind(t,e);else var a=avalon.bind(t,r,e);n.rollback=function(){"function"==typeof n.specialUnbind?n.specialUnbind():avalon.unbind(t,r,a)}},bindingHandlers.repeat=function(e,t){var n=e.type;parseExprProxy(e.value,t,e,0,1);var r=!1;try{var a=e.$repeat=e.evaluator.apply(0,e.args||[]),o=avalon.type(a);"object"!==o&&"array"!==o&&(r=!0,avalon.log("warning:"+e.value+"只能是对象或数组"))}catch(i){r=!0}var s=e.value.split(".")||[];if(s.length>1){s.pop();for(var l,c=s[0],u=0;l=t[u++];)if(l&&l.hasOwnProperty(c)){var d=l[c].$events||{};d[subscribers]=d[subscribers]||[],d[subscribers].push(e);break}}var p=e.element;p.removeAttribute(e.name),e.sortedCallback=getBindingCallback(p,"data-with-sorted",t),e.renderedCallback=getBindingCallback(p,"data-"+n+"-rendered",t);var f=generateID(n),v=e.element=DOC.createComment(f+":end");if(e.clone=DOC.createComment(f),hyperspace.appendChild(v),"each"===n||"with"===n?(e.template=p.innerHTML.trim(),avalon.clearHTML(p).appendChild(v)):(e.template=p.outerHTML.trim(),p.parentNode.replaceChild(v,p)),e.template=avalon.parseHTML(e.template),e.rollback=function(){var t=e.element;if(t){bindingExecutors.repeat.call(e,"clear");var n=t.parentNode,r=e.template,a=r.firstChild;n.replaceChild(r,t);var o=e.$with;o&&o.parentNode&&o.parentNode.removeChild(o),a=e.element="repeat"===e.type?a:n}},!r){e.handler=bindingExecutors.repeat,e.$outer={};var h="$key",m="$val";for(Array.isArray(a)&&(a.$map[e.param||"el"]=1,h="$first",m="$last"),u=0;l=t[u++];)if(l.hasOwnProperty(h)&&l.hasOwnProperty(m)){e.$outer=l;break}var g=a.$events,y=(g||{})[subscribers];if(y&&avalon.Array.ensure(y,e)&&addSubscribers(e,y),"object"===o){e.$with=!0;var b=g?g.$withProxyPool||(g.$withProxyPool={}):{};e.handler("append",a,b)}else a.length&&e.handler("add",0,a.length)}},bindingExecutors.repeat=function(e,t,n){if(e){var r,a,o=this,i=o.element,s=getComments(o),l=i.parentNode,c=hyperspace.cloneNode(!1);switch(e){case"add":for(var u=t+n,d=[],p=o.$repeat,f=t;u>f;f++){var v=p.$proxy[f];v.$outer=o.$outer,shimController(o,c,v,d)}for(l.insertBefore(c,s[t]||i),f=0;a=d[f++];)scanNodeArray(a.nodes,a.vmodels),a.nodes=a.vmodels=null;break;case"del":sweepNodes(s[t],s[t+n]||i);break;case"clear":r=s[0],r&&sweepNodes(r,i);break;case"move":if(r=s[0]){var h,m=r.nodeValue,g=[],y=[];for(sweepNodes(r,i,function(){y.unshift(this),this.nodeValue===m&&(g.unshift(y),y=[])}),sortByIndex(g,t);y=g.shift();)for(;h=y.shift();)c.appendChild(h);l.insertBefore(c,i)}break;case"append":var b=n,x=[];d=[];for(var w in t)t.hasOwnProperty(w)&&"hasOwnProperty"!==w&&x.push(w);if(o.sortedCallback){var $=o.sortedCallback.call(l,x);$&&Array.isArray($)&&$.length&&(x=$)}for(f=0;w=x[f++];)"hasOwnProperty"!==w&&(b[w]||(b[w]=withProxyAgent(w,o)),shimController(o,c,b[w],d));var C=o.$with=o.clone;for(l.insertBefore(C,i),l.insertBefore(c,i),f=0;a=d[f++];)scanNodeArray(a.nodes,a.vmodels),a.nodes=a.vmodels=null}"clear"===e&&(e="del");var k=o.renderedCallback||noop,T=arguments;checkScan(l,function(){k.apply(l,T),l.oldValue&&"SELECT"===l.tagName&&avalon(l).val(l.oldValue.split(","))},0/0)}},"with,each".replace(rword,function(e){bindingHandlers[e]=bindingHandlers.repeat});var eachProxyPool=[],withProxyPool=[];bindingExecutors.text=function(e,t){if(e=null==e?"":e,3===t.nodeType)try{t.data=e}catch(n){}else t.textContent=e},avalon.parseDisplay=parseDisplay,bindingHandlers.visible=function(e,t){var n=avalon(e.element),r=n.css("display");if("none"===r){var a=n[0].style,o=/visibility/i.test(a.cssText),i=n.css("visibility");a.display="",a.visibility="hidden",r=n.css("display"),"none"===r&&(r=parseDisplay(n[0].nodeName)),a.visibility=o?i:""}e.display=r,parseExprProxy(e.value,t,e)},bindingExecutors.visible=function(e,t,n){t.style.display=e?n.display:"none"},bindingHandlers.widget=function(e,t){var n=e.value.match(rword),r=e.element,a=n[0],o=n[1];o&&"$"!==o||(o=generateID(a));var i=n[2]||a,s=avalon.ui[a];if("function"==typeof s){t=r.vmodels||t;for(var l,c=0;l=t[c++];)if(l.hasOwnProperty(i)&&"object"==typeof l[i]){var u=l[i];u=u.$model||u;break}if(u){var d=u[a+"Id"];"string"==typeof d&&(log("warning!不再支持"+a+"Id"),o=d)}var p=avalon.getWidgetData(r,a);e.value=[a,o,i].join(","),e[a+"Id"]=o,e.evaluator=noop,r.msData["ms-widget-id"]=o;var f=e[a+"Options"]=avalon.mix({},s.defaults,u||{},p);r.removeAttribute("ms-widget");var v=s(r,e,t)||{};if(v.$id){avalon.vmodels[o]=v,createSignalTower(r,v);try{v.$init(function(){avalon.scan(r,[v].concat(t)),"function"==typeof f.onInit&&f.onInit.call(r,v,f,t)})}catch(h){}e.rollback=function(){try{v.widgetElement=null,v.$remove()}catch(e){}r.msData={},delete avalon.vmodels[v.$id]},addSubscribers(e,widgetList),window.chrome&&r.addEventListener("DOMNodeRemovedFromDocument",function(){setTimeout(removeSubscribers)})}else avalon.scan(r,t)}else t.length&&(r.vmodels=t)};var widgetList=[],rscripts=/<script[^>]*>([\S\s]*?)<\/script\s*>/gim,ron=/\s+(on[^=\s]+)(?:=("[^"]*"|'[^']*'|[^\s>]+))?/g,ropen=/<\w+\b(?:(["'])[^"]*?(\1)|[^>])*>/gi,rsanitize={a:/\b(href)\=("javascript[^"]*"|'javascript[^']*')/gi,img:/\b(src)\=("javascript[^"]*"|'javascript[^']*')/gi,form:/\b(action)\=("javascript[^"]*"|'javascript[^']*')/gi},rsurrogate=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,rnoalphanumeric=/([^\#-~| |!])/g,filters=avalon.filters={uppercase:function(e){return e.toUpperCase()},lowercase:function(e){return e.toLowerCase()},truncate:function(e,t,n){return t=t||30,n=void 0===n?"...":n,e.length>t?e.slice(0,t-n.length)+n:String(e)},$filter:function(e){for(var t=1,n=arguments.length;n>t;t++){var r=arguments[t],a=avalon.filters[r.shift()];if("function"==typeof a){var o=[e].concat(r);e=a.apply(null,o)}}return e},camelize:camelize,sanitize:function(e){return e.replace(rscripts,"").replace(ropen,function(e){var t=e.toLowerCase().match(/<(\w+)\s/);if(t){var n=rsanitize[t[1]];n&&(e=e.replace(n,function(e,t,n){var r=n.charAt(0);return t+"="+r+"javascript:void(0)"+r}))}return e.replace(ron," ").replace(/\s+/g," ")})},escape:function(e){return String(e).replace(/&/g,"&amp;").replace(rsurrogate,function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1);return"&#"+(1024*(t-55296)+(n-56320)+65536)+";"}).replace(rnoalphanumeric,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")},currency:function(e,t,n){return(t||"￥")+numberFormat(e,isFinite(n)?n:2)},number:numberFormat};!new function(){function e(e){return parseInt(e,10)||0}function t(e,t,n){var r="";for(0>e&&(r="-",e=-e),e=""+e;e.length<t;)e="0"+e;return n&&(e=e.substr(e.length-t)),r+e}function n(e,n,r,a){return function(o){var i=o["get"+e]();return(r>0||i>-r)&&(i+=r),0===i&&-12===r&&(i=12),t(i,n,a)}}function r(e,t){return function(n,r){var a=n["get"+e](),o=(t?"SHORT"+e:e).toUpperCase();return r[o][a]}}function a(e){var n=-1*e.getTimezoneOffset(),r=n>=0?"+":"";return r+=t(Math[n>0?"floor":"ceil"](n/60),2)+t(Math.abs(n%60),2)}function o(e,t){return e.getHours()<12?t.AMPMS[0]:t.AMPMS[1]}var i={yyyy:n("FullYear",4),yy:n("FullYear",2,0,!0),y:n("FullYear",1),MMMM:r("Month"),MMM:r("Month",!0),MM:n("Month",2,1),M:n("Month",1,1),dd:n("Date",2),d:n("Date",1),HH:n("Hours",2),H:n("Hours",1),hh:n("Hours",2,-12),h:n("Hours",1,-12),mm:n("Minutes",2),m:n("Minutes",1),ss:n("Seconds",2),s:n("Seconds",1),sss:n("Milliseconds",3),EEEE:r("Day"),EEE:r("Day",!0),a:o,Z:a},s=/((?:[^yMdHhmsaZE']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z))(.*)/,l=/^\/Date\((\d+)\)\/$/;filters.date=function(t,n){var r,a,o=filters.date.locate,c="",u=[];if(n=n||"mediumDate",n=o[n]||n,"string"==typeof t)if(/^\d+$/.test(t))t=e(t);else if(l.test(t))t=+RegExp.$1;else{var d=t.trim(),p=[0,0,0,0,0,0,0],f=new Date(0);d=d.replace(/^(\d+)\D(\d+)\D(\d+)/,function(t,n,r,a){var o=4===a.length?[a,n,r]:[n,r,a];return p[0]=e(o[0]),p[1]=e(o[1])-1,p[2]=e(o[2]),""});var v=f.setFullYear,h=f.setHours;d=d.replace(/[T\s](\d+):(\d+):?(\d+)?\.?(\d)?/,function(t,n,r,a,o){return p[3]=e(n),p[4]=e(r),p[5]=e(a),o&&(p[6]=Math.round(1e3*parseFloat("0."+o))),""});var m=0,g=0;d=d.replace(/Z|([+-])(\d\d):?(\d\d)/,function(t,n,r,a){return v=f.setUTCFullYear,h=f.setUTCHours,n&&(m=e(n+r),g=e(n+a)),""}),p[3]-=m,p[4]-=g,v.apply(f,p.slice(0,3)),h.apply(f,p.slice(3)),t=f}if("number"==typeof t&&(t=new Date(t)),"date"===avalon.type(t)){for(;n;)a=s.exec(n),a?(u=u.concat(a.slice(1)),n=u.pop()):(u.push(n),n=null);return u.forEach(function(e){r=i[e],c+=r?r(t,o):e.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),c}};var c={AMPMS:{0:"上午",1:"下午"},DAY:{0:"星期日",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},MONTH:{0:"1月",1:"2月",2:"3月",3:"4月",4:"5月",5:"6月",6:"7月",7:"8月",8:"9月",9:"10月",10:"11月",11:"12月"},SHORTDAY:{0:"周日",1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六"},fullDate:"y年M月d日EEEE",longDate:"y年M月d日",medium:"yyyy-M-d H:mm:ss",mediumDate:"yyyy-M-d",mediumTime:"H:mm:ss","short":"yy-M-d ah:mm",shortDate:"yy-M-d",shortTime:"ah:mm"};c.SHORTMONTH=c.MONTH,filters.date.locate=c};var modules=avalon.modules={"domReady!":{exports:avalon,state:3},avalon:{exports:avalon,state:4}};modules.exports=modules.avalon,new function(){function e(e,t){var n="js";e=e.replace(/^(\w+)\!/,function(e,t){return n=t,""}),"ready"===n&&(log("debug: ready!已经被废弃，请使用domReady!"),n="domReady");var r="";e=e.replace(D,function(e){return r=e,""});var a="."+n,o=/js|css/.test(a)?a:"";e=e.replace(/\.[a-z0-9]+$/g,function(e){return e===a?(o=e,""):e});var i=avalon.mix({query:r,ext:o,res:n,name:e,toUrl:d},t);return i.toUrl(e),i}function t(e){var t=e.name,n=e.res,r=modules[t],a=t&&e.urlNoQuery;if(r&&r.state>=1)return t;if(r=modules[a],r&&r.state>=3)return innerRequire(r.deps||[],r.factory,a),a;if(t&&!r){r=modules[a]={id:a,state:1};var i=function(a){M[n]=a,a.load(t,e,function(e){arguments.length&&void 0!==e&&(r.exports=e),r.state=4,o()})};M[n]?i(M[n]):innerRequire([n],i)}return t?a:n+"!"}function n(e,t){for(var r,a=0;r=e[a++];)if(4!==modules[r].state&&(r===t||n(modules[r].deps,t)))return!0}function r(e,t){var n=s(e.src);return e.onload=e.onerror=null,t?(setTimeout(function(){head.removeChild(e),e=null}),void log("debug: 加载 "+n+" 失败"+t+" "+!modules[n].state)):!0}function o(){e:for(var e,t=x.length;e=x[--t];){var n=modules[e],r=n.deps;if(r){for(var a,i=0;a=r[i];i++)if(4!==Object(modules[a]).state)continue e;4!==n.state&&(x.splice(t,1),u(n.id,n.deps,n.factory),o())}}}function i(e,t,n){var a=DOC.createElement("script");a.className=subscribers,a.onload=function(){var r=w.pop();r&&r.require(t),n&&n(),log("debug: 已成功加载 "+e),t&&x.push(t),o()},a.onerror=function(){r(a,!0)},head.insertBefore(a,head.firstChild),a.src=e,log("debug: 正准备加载 "+e)}function s(e){return(e||"").replace(D,"")}function l(e){return/^(?:[a-z]+:)?\/\//i.test(String(e))}function c(){var e;try{a.b.c()}catch(t){e=t.stack}if(e)return e=e.split(/[@ ]/g).pop(),e="("===e[0]?e.slice(1,-1):e.replace(/\s/,""),s(e.replace(/(:\d+)?:\d+$/i,""));for(var n,r=head.getElementsByTagName("script"),o=r.length;n=r[--o];)if(n.className===subscribers&&"interactive"===n.readyState){var i=n.src;return n.className=s(i)}}function u(e,t,n){var r=Object(modules[e]);r.state=4;for(var a,o=0,i=[];a=t[o++];)if("exports"===a){var s=r.exports||(r.exports=createMap());i.push(s)}else i.push(modules[a].exports);try{var l=n.apply(window,i)}catch(c){log("执行["+e+"]模块的factory抛错： "+c)}return void 0!==l&&(r.exports=l),H.test(e)&&delete modules[e],delete r.factory,l}function d(e){0===e.indexOf(this.res+"!")&&(e=e.slice(this.res.length+1));var t=e,n=0,r=this.baseUrl,a=this.parentUrl||r;m(e,kernel.paths,function(e,r){t=t.replace(r,e),n=1}),n||m(e,kernel.packages,function(e,n,r){t=t.replace(r.name,r.location)}),this.mapUrl&&m(this.mapUrl,kernel.map,function(e){m(t,e,function(e,n){t=t.replace(n,e),a=r})});var o=this.ext;o&&n&&t.slice(-o.length)===o&&(t=t.slice(0,-o.length)),l(t)||(a=this.built||/^\w/.test(t)?r:a,t=y(a,t));var i=t+o;return t=i+this.query,m(e,kernel.urlArgs,function(e){t+=(-1===t.indexOf("?")?"?":"&")+e}),this.url=t,this.urlNoQuery=i}function p(e,t,n){var r=h(e,t,n);return r.sort(g),r}function f(e){return new RegExp("^"+e+"(/|$)")}function v(e){return function(){var t;return e.init&&(t=e.init.apply(window,arguments)),t||e.exports&&b(e.exports)}}function h(e,t,n){var r=[];for(var a in e){var o={name:a,val:e[a]};r.push(o),o.reg="*"===a&&t?/^/:f(a),n&&"*"!==a&&(o.reg=new RegExp("/"+a.replace(/^\//,"")+"(/|$)"))}return r}function m(e,t,n){t=t||[];for(var r,a=0;r=t[a++];)if(r.reg.test(e))return n(r.val,r.name,r),!1}function g(e,t){var n=e.name,r=t.name;return"*"===r?-1:"*"===n?1:r.length-n.length}function y(e,t){if("/"!==e.charAt(e.length-1)&&(e+="/"),"./"===t.slice(0,2))return e+t.slice(2);if(".."===t.slice(0,2)){for(e+=t;N.test(e);)e=e.replace(N,"");return e}return"/"===t.slice(0,1)?e+t.slice(1):e+t}function b(e){if(!e)return e;var t=window;return e.split(".").forEach(function(e){t=t[e]}),t}var x=[],w=[],$=/\.js$/i,C=[],k=!1;innerRequire=avalon.require=function(n,r,a,i){if(k){Array.isArray(n)||avalon.error("require方法的第一个参数应为数组 "+n);var s=[],l=createMap(),c=a||"callback"+setTimeout("1");i=i||createMap(),i.baseUrl=kernel.baseUrl;var u=!!i.built;if(a&&(i.parentUrl=a.substr(0,a.lastIndexOf("/")),i.mapUrl=a.replace($,"")),u){var d=e(i.defineName,i);c=d.urlNoQuery}else n.forEach(function(n){var r=e(n,i),a=t(r);a&&(l[a]||(s.push(a),l[a]="司徒正美"))});var p=modules[c];p&&4===p.state||(modules[c]={id:c,deps:u?n.concat():s,factory:r||noop,state:3}),p||x.push(c),o()}else if(C.push(avalon.slice(arguments)),arguments.length<=2){k=!0;for(var f,v=C.splice(0,C.length);f=v.shift();)innerRequire.apply(null,f)}},innerRequire.define=function(e,t,r){"string"!=typeof e&&(r=t,t=e,e="anonymous"),Array.isArray(t)||(r=t,t=[]);
var a={built:!k,defineName:e},o=[t,r,a];r.require=function(e){if(o.splice(2,0,e),modules[e]){modules[e].state=3;var t=!1;try{t=n(modules[e].deps,e)}catch(a){}t&&avalon.error(e+"模块与之前的模块存在循环依赖，请不要直接用script标签引入"+e+"模块")}delete r.require,innerRequire.apply(null,o)};var i=a.built?"unknown":c();if(i){var s=modules[i];s&&(s.state=2),r.require(i)}else w.push(r)},innerRequire.config=kernel,innerRequire.define.amd=modules;var T=kernel["orig.paths"]=createMap(),E=kernel["orig.map"]=createMap(),A=kernel.packages=[],O=kernel["orig.args"]=createMap();avalon.mix(plugins,{paths:function(e){avalon.mix(T,e),kernel.paths=p(T)},map:function(e){avalon.mix(E,e);var t=p(E,1,1);avalon.each(t,function(e,t){t.val=p(t.val)}),kernel.map=t},packages:function(e){e=e.concat(A);for(var t,n=createMap(),r=[],a=0;t=e[a++];){t="string"==typeof t?{name:t}:t;var o=t.name;if(!n[o]){var i=y(t.location||o,t.main||"main");i=i.replace($,""),r.push(t),n[o]=t.location=i,t.reg=f(o)}}kernel.packages=r.sort()},urlArgs:function(e){"string"==typeof e&&(e={"*":e}),avalon.mix(O,e),kernel.urlArgs=p(O,1)},baseUrl:function(e){if(!l(e)){var t=head.getElementsByTagName("base")[0];t&&head.removeChild(t);var n=DOC.createElement("a");n.href=e,e=n.href,t&&head.insertBefore(t,head.firstChild)}e.length>3&&(kernel.baseUrl=e)},shim:function(e){for(var t in e){var n=e[t];Array.isArray(n)&&(n=e[t]={deps:n}),n.exportsFn||!n.exports&&!n.init||(n.exportsFn=v(n))}kernel.shim=e}});var M=innerRequire.plugins={ready:{load:noop},js:{load:function(e,t,n){var r=t.url,a=t.urlNoQuery,o=kernel.shim[e.replace($,"")];o?innerRequire(o.deps||[],function(){var e=avalon.slice(arguments);i(r,a,function(){n(o.exportsFn?o.exportsFn.apply(0,e):void 0)})}):i(r,a)}},css:{load:function(e,t,n){var r=t.url;head.insertAdjacentHTML("afterBegin",'<link rel="stylesheet" href="'+r+'">'),log("debug: 已成功加载 "+r),n()}},text:{load:function(e,t,n){var r=t.url,a=getXHR();a.onload=function(){var e=a.status;e>399&&600>e?avalon.error(r+" 对应资源不存在或没有开启 CORS"):(log("debug: 已成功加载 "+r),n(a.responseText))},a.open("GET",r,!0),"withCredentials"in a&&(a.withCredentials=!0),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.send(),log("debug: 正准备加载 "+r)}}};innerRequire.checkDeps=o;var D=/(\?[^#]*)$/,H=/^callback\d+$/,N=/\/\w+\/\.\./,S=DOC.scripts[DOC.scripts.length-1],L=S.getAttribute("data-main");if(L){plugins.baseUrl(L);var P=kernel.baseUrl;kernel.baseUrl=P.slice(0,P.lastIndexOf("/")+1),i(P.replace($,"")+".js")}else{var R=s(S.src);kernel.baseUrl=R.slice(0,R.lastIndexOf("/")+1)}};var readyList=[],isReady,fireReady=function(e){for(isReady=!0,innerRequire&&(modules["domReady!"].state=4,innerRequire.checkDeps());e=readyList.shift();)e(avalon)};"complete"===DOC.readyState?setTimeout(fireReady):DOC.addEventListener("DOMContentLoaded",fireReady),window.addEventListener("load",fireReady),avalon.ready=function(e){isReady?e(avalon):readyList.push(e)},avalon.config({loader:!0}),avalon.ready(function(){avalon.scan(DOC.body)}),new function(){function e(e){return("touch"===e.pointerType||e.pointerType===e.MSPOINTER_TYPE_TOUCH)&&e.isPrimary}function t(e,t){return e.type==="pointer"+t||e.type.toLowerCase()==="mspointer"+t}function n(e,t,n,r){return Math.abs(e-t)>=Math.abs(n-r)?e-t>0?"left":"right":n-r>0?"up":"down"}function r(e){var t=e.touches&&e.touches.length?e.touches:[e],n=e.changedTouches?e.changedTouches[0]:t[0];return{x:n.clientX,y:n.clientY}}function a(e,t,n){var r=document.createEvent("Events");r.initEvent(t,!0,!0),r.fireByAvalon=!0,n&&(r.detail=n),e.dispatchEvent(r)}function o(e){return e.fireByAvalon?!0:void(v.element&&"select"!==e.target.tagName.toLowerCase()&&(e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0,e.stopPropagation(),e.preventDefault(),"click"===e.type&&(v.element=null)))}function i(){x&&clearTimeout(x),x=null}function s(n){var o=t(n,"down"),i=o?n:n.touches&&n.touches[0]||n,s="tagName"in i.target?i.target:i.target.parentNode,l=Date.now(),c=l-(v.last||l);if(!o||e(n))return avalon.mix(v,r(n)),v.mx=0,v.my=0,c>0&&250>=c&&(v.isDoubleTap=!0),v.last=l,v.element=s,avalon(s).addClass(w.activeClass),x=setTimeout(function(){x=null,a(s,"hold"),a(s,"longtap"),v={},avalon(s).removeClass(w.activeClass)},w.clickDuration),!0}function l(n){var a=t(n,"down"),o=r(n);d&&Math.abs(v.x-o.x)>10&&n.preventDefault(),(!a||e(n))&&(i(),v.mx+=Math.abs(v.x-o.x),v.my+=Math.abs(v.y-o.y))}function c(o){var s=t(o,"down");if(element=v.element,(!s||e(o))&&element){i();var l=r(o),c=Math.abs(v.x-l.x),u=Math.abs(v.y-l.y);if(c>30||u>30){var d=n(v.x,l.x,v.y,l.y),p={direction:d};a(element,"swipe",p),a(element,"swipe"+d,p),avalon(element).removeClass(w.activeClass),v={},v.element=element}else if(w.canClick(element)&&v.mx<w.dragDistance&&v.my<w.dragDistance){document.activeElement&&document.activeElement!==element&&document.activeElement.blur();var f;"label"===element.tagName.toLowerCase()&&(f=element.htmlFor?document.getElementById(element.htmlFor):null),w.focus(f?f:element),"select"!==o.target.tagName.toLowerCase()&&o.preventDefault(),a(element,"tap"),avalon.fastclick.fireEvent(element,"click",o),avalon(element).removeClass(w.activeClass),v.isDoubleTap?(a(element,"doubletap"),avalon.fastclick.fireEvent(element,"dblclick",o),v={},avalon(element).removeClass(w.activeClass),v.element=element):b=setTimeout(function(){clearTimeout(b),b=null,v={},avalon(element).removeClass(w.activeClass),v.element=element},250)}}}var u=navigator.userAgent,d=u.indexOf("Android")>0,p=/iP(ad|hone|od)/.test(u),f=bindingHandlers.on,v={},h=navigator.pointerEnabled,m=navigator.msPointerEnabled,g=function(){var e=p||!1;try{var t=document.createElement("div");t.ontouchstart=function(){e=!0};var n=document.createEvent("TouchEvent");n.initUIEvent("touchstart",!0,!0),t.dispatchEvent(n)}catch(r){}return t=t.ontouchstart=null,e}(),y=["mousedown","mousemove","mouseup",""];g?y=["touchstart","touchmove","touchend","touchcancel"]:h?y=["pointerdown","pointermove","pointerup","pointercancel"]:m&&(y=["MSPointerDown","MSPointerMove","MSPointerUp","MSPointerCancel"]);var b,x;document.addEventListener("mousedown",o,!0),document.addEventListener("click",o,!0),document.addEventListener(y[0],s),document.addEventListener(y[1],l),document.addEventListener(y[2],c),y[3]&&document.addEventListener(y[3],function(){x&&clearTimeout(x),b&&clearTimeout(b),x=b=null,v={}});var w=avalon.fastclick={activeClass:"ms-click-active",clickDuration:750,dragDistance:30,fireEvent:function(e,t,n){var r=document.createEvent("MouseEvents");r.initMouseEvent(t,!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),Object.defineProperty(r,"fireByAvalon",{value:!0}),e.dispatchEvent(r)},focus:function(e){if(this.canFocus(e)){var t=e.value;if(e.value=t,p&&e.setSelectionRange&&0!==e.type.indexOf("date")&&"time"!==e.type){var n=t.length;e.setSelectionRange(n,n)}else e.focus()}},canClick:function(e){switch(e.nodeName.toLowerCase()){case"textarea":case"select":case"input":return!e.disabled;default:return!0}},canFocus:function(e){switch(e.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!d;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return!1}}};["swipe","swipeleft","swiperight","swipeup","swipedown","doubletap","tap","dblclick","longtap","hold"].forEach(function(e){f[e+"Hook"]=f.clickHook})},"function"==typeof define&&define.amd&&define("avalon",[],function(){return avalon});var _avalon=window.avalon;return avalon.noConflict=function(e){return e&&window.avalon===avalon&&(window.avalon=_avalon),avalon},void 0===noGlobal&&(window.avalon=avalon),window._injectTer=function(code){return eval(code)},avalon});